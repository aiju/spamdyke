<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
<title>spamdyke: Documentation</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
<link rel="stylesheet" type="text/css" href="http://www.spamdyke.org/style/style.css" />
<link rel="icon" href="http://www.spamdyke.org/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="http://www.spamdyke.org/favicon.ico" type="image/x-icon">
</head>

<body>
<div id="main">
<div id="links_container">
<div id="logo"><h1>spamdyke</h1><h2>A drop-in connection-time spam filter for qmail</h2></div>
<div id="links">
</div>
</div>
<div id="menu">
<ul>
<li><a href="http://www.spamdyke.org/">Home</a></li>
<li><a href="http://www.spamdyke.org/download.html">Download</a></li>
<li><a id="selected" href="#">Documentation</a></li>
<li><a href="FAQ.html">FAQ</a></li>
<li><a href="http://www.spamdyke.org/support.html">Support</a></li>
<li><a href="http://www.spamdyke.org/mailinglists.html">Mailing Lists</a></li>
<li><a href="http://www.spamdyke.org/links.html">Links</a></li>
</ul>
</div>
<div id="content">
<!--#include virtual="../includes/rightnav.html"-->
<div id="column2">

<h1>spamdyke Documentation</h1>
<p>
This file is updated with each version of spamdyke to reflect the latest
features and behavior.  If you need documentation for an older version, each version's README
file is included in the download package for that version.
</p><p>
<b>This document applies to spamdyke version 5.0.1.</b>
<ul>
<li><a href="#ABOUT">About spamdyke</a></li>
<li><a href="#SUPPORT">Support</a></li>
<li><a href="#HOWITWORKS_UNBLOCKED">How spamdyke works: When a message is not blocked</a></li>
<li><a href="#HOWITWORKS_BLOCKED">How spamdyke works: When a message is blocked</a></li>
<li><a href="#USAGE">Usage</a></li>
<li><a href="#CONFIGURATION_FILE">Configuration Files</a></li>
<li><a href="#CONFIGURATION_DIR">Configuration Directories</a></li>
<li><a href="#CONFIGURATION_TEST">Configuration Tests</a></li>
<li><a href="#LOG">Log Messages</a></li>
<li><a href="#SMTP_ERROR">SMTP Error Codes</a></li>
<li><a href="#FULL_LOGGING">Logging All Data</a></li>
<li><a href="#PERMISSIONS">Permissions</a></li>
<li><a href="#DNS_QUERIES">DNS Queries</a></li>
<li><a href="#FILTER_LEVELS">Filter Levels</a></li>
<li><a href="#TLS">TLS</a></li>
<li><a href="#SMTP_AUTH">SMTP AUTH</a></li>
<li><a href="#RELAYING">Relaying</a></li>
<li><a href="#RDNS">Reverse DNS</a></li>
<li><a href="#BLACKLISTS">Blacklists</a></li>
<li><a href="#DNSRBL">DNS RBLs</a></li>
<li><a href="#DNSRHSBL">DNS RHSBLs</a></li>
<li><a href="#WHITELISTS">Whitelists</a></li>
<li><a href="#REJECTING_SENDERS">Rejecting Senders</a></li>
<li><a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a></li>
<li><a href="#DNSWHITELISTS">DNS Whitelists</a></li>
<li><a href="#WHITELISTING_ADDRESSES">Whitelisting Senders and Recipients</a></li>
<li><a href="#GRAYLISTS">Graylisting / Greylisting</a></li>
<li><a href="#EARLYTALKERS">Earlytalkers</a></li>
<li><a href="#MAXRECIPIENTS">Limiting Numbers of Recipients</a></li>
<li><a href="#HEADERS">Rejecting Messages by Header Content</a></li>
<li><a href="#TIMEOUTS">Timeouts</a></li>
<li><a href="#UTILITIES">Extra Utilities</a></li>
</ul>
</p>

<h2>Other Documentation</h2>
<p>
<dl>
<dt>The following additional documents are available:
<dd><a href="INSTALL.txt">Installation instructions: INSTALL.txt</a>
<dd><a href="UPGRADING.txt">Upgrading instructions: UPGRADING.txt</a>
<dd><a href="FAQ.html">Frequently Asked Questions: FAQ.html</a>
<dd><a href="Changelog.txt">Change log: Changelog.txt</a>
<dd><a href="development_notes/TODO.txt">To-do list: TODO.txt</a>
</dl>
</p>

<a name="ABOUT"></a>
<h2>About spamdyke</h2>
<h3>
<code>help</code><br />
<code>more-help</code><br />
<code>version</code>
</h3>
<p>
spamdyke is a filter for monitoring and intercepting incoming SMTP connections
to a qmail server.  It acts as a transparent middleman, observing the
conversation without interference unless it sees something it should block.
Because it can silently monitor, it can also log mail traffic in several different ways.
</p><p>
spamdyke is &copy;2015 Sam Clippinger, <a href="mailto:samc%40silence%2Eorg">samc (at) silence (dot) org</a>.
It is distributed under the GNU General Public License (version 2 only) from
<a href="http://www.spamdyke.org/">http://www.spamdyke.org/</a>
</p><p>
The <code>--help</code> command line option will give a list of the
available options.  The <code>--more-help</code> command line option
will give a more detailed list of available options and their default values.
The <code>--version</code> command line option
will give just the version and copyright statement.
</p>

<a name="SUPPORT"></a>
<h2>Support</h2>
<p>
spamdyke support is available from the spamdyke-users mailing list: <a href="http://www.spamdyke.org/mailman/listinfo/spamdyke-users">www.spamdyke.org/mailman/listinfo/spamdyke-users</a>.
</p><p>
The mailing list archives are searchable thanks to mail-archive.com: <a href="http://www.mail-archive.com/spamdyke-users@spamdyke.org">www.mail-archive.com/spamdyke-users@spamdyke.org</a>.
<p></p>
All of the spamdyke documentation and downloadable files are available from the spamdyke website: <a href="http://www.spamdyke.org/">www.spamdyke.org</a>.
</p><p>
If all else fails, email the author directly at <a href="mailto:samc%40silence%2Eorg">samc (at) silence (dot) org</a>.
</p>

<a name="HOWITWORKS_UNBLOCKED"></a>
<h2>How spamdyke works: When a message is not blocked</h2>
<p>
spamdyke works by acting as a middleman between qmail and the network (in Unix terms, it's a pipe).
When no spamdyke filters are triggered and a message is delivered normally, spamdyke silently passes
data in both directions.  As the SMTP conversation takes place, spamdyke collects a few pieces of data
(e.g. the sender and recipient addresses) so they can be logged.
</p><p>
spamdyke does modify the incoming message in one way.  The SMTP protocol requires
the remote sender to end every line with a two character terminator -- a carriage
return and a line feed.  Unlike most other mail servers, qmail chooses to strictly enforce this requirement.  If
a remote sender uses only a line feed to end a line (a typical and easy mistake to make),
qmail will reject the message:
<dl>
<dd><code>451 See http://pobox.com/~djb/docs/smtplf.html.</code>
</dl>
Because qmail's strict enforcement of the protocol tends to cause more problems than it solves,
spamdyke silently helps mail clients avoid this error by inserting a carriage return
before any bare line feed characters it sees.  This doesn't affect the messages,
it only allows poorly-written mail clients to send email.
</p>

<a name="HOWITWORKS_BLOCKED"></a>
<h2>How spamdyke works: When a message is blocked</h2>
<p>
spamdyke's filters are described in detail below.  When one of them is triggered,
spamdyke moves in to block the incoming message.
</p><p>
First, it considers the enabled filters and waits until there is no way the client
can avoid a rejection.  For example, if authentication <i>could</i> take place
but has not done so, spamdyke will wait to see if the remote sender
authenticates.  Authenticated or whitelisted connections are never filtered.
</p><p>
Next, once spamdyke is certain the message should be filtered, it cuts the
connection between the remote sender and qmail.  In the background, spamdyke
closes the connection to qmail, so qmail will exit normally, believing the remote sender
disconnected.
</p><p>
spamdyke continues sending responses to the remote server, just as qmail
would have.  Once the remote sender has identified the sender and recipient,
spamdyke sends an error code and refuses to accept the message.  The
remote server disconnects, never knowing that spamdyke hijacked the
conversation.  spamdyke, meanwhile, uses the sender and recipient information
it gathered to construct its log messages.
</p>

<a name="USAGE"></a>
<h2>Usage</h2>
<p>
spamdyke's behavior is controlled through options given on the command line
or in configuration files (or both).
</p><p>
On the command line, long options should be prefixed
with two hyphens (<code>--</code>).  Some options have short versions, which
should be prefixed with one hyphen (<code>-</code>).
</p><p>
In a configuration file, only the long versions are valid and an equals sign
must separate the value from the option.
See <a href="#CONFIGURATION_FILE">Configuration Files</a> for details.
</p><p>
For example, consider the <code>max-recipients</code> option, which restricts the
maximum number of recipients per message.  On the command line, limiting the number
of recipients to 5 might look like this:
<dl>
<dd><code>spamdyke --max-recipients 5 ...</code>
</dl>
Or, since its short version has the same meaning, the command line could look like this:
<dl>
<dd><code>spamdyke -a 5 ...</code>
</dl>
In a configuration file, only the long version is valid and an equals sign is required,
so the entry would look like this:
<dl>
<dd><code>max-recipients=5</code>
</dl>
</p><p>
If the option's value contains spaces, it should be surrounded by quotes on the command line.
For example, consider the <code>rejection-text-ip-blacklist</code> option, which changes
the error message spamdyke sends if the remote server's IP address is blacklisted.
On the command line, changing the message might look like this:
<dl>
<dd><code>spamdyke --rejection-text-ip-blacklist "Go away spammer" ...</code>
</dl>
However, in a configuration file quotes are not allowed, so the entry would look like this:
<dl>
<dd><code>rejection-text-ip-blacklist=Go away spammer</code>
</dl>
</p><p>
After all options are given, spamdyke expects the rest of its command line to contain
the qmail command.  For example:
<dl>
<dd><code>spamdyke -a 5 /var/qmail/bin/qmail-smtpd</code>
</dl>
Sometimes, depending on the options in use, spamdyke's command line parser can become
confused.  If spamdyke believes the qmail command is a parameter to one of its
options, you may see the following error message:
<dl>
<dd><code>ERROR: Missing qmail-smtpd command</code>
</dl>
To resolve this, place two hyphens (<code>--</code>) between the end of spamdyke's options and the qmail
command.  For example:
<dl>
<dd><code>spamdyke -a 5 -- /var/qmail/bin/qmail-smtpd</code>
</dl>
</p><p>
The following options are only valid on the command line:
<table border=1 cellspacing=0 width=100% class="options">
<tr>
<td><b>Long Version</b></td>
<td><b>Short Version</b></td>
<td><b>Parameter</b></td>
<td><b>Description</b></td>

</tr><tr>
<td><code>config-test</code></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>
Tests the configuration as much as possible and reports any errors that can be discovered without actually accepting an incoming message.
Use this option with all other options that are given during normal operation. To check file permissions properly, use the <code>run-as-user</code> option.
<br /><br />
See <a href="#CONFIGURATION_TEST">Configuration Tests</a> for details.
</td>

</tr><tr>
<td><code>config-test-smtpauth-password</code></td>
<td>&nbsp;</td>
<td><code>PASSWORD</code></td>
<td>
While testing the configuration with <code>config-test</code>, run the commands given with
<code>smtp-auth-command</code> to test authentication
processing. Use <code>PASSWORD</code> as the authentication password. This option has no
effect unless <code>config-test</code>, <code>config-test-smtpauth-username</code> and
<code>smtp-auth-command</code> are given.
<br /><br />
If <code>config-test-smtpauth-password</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>config-test-smtpauth-password</code> is not given, spamdyke will not test the authentication
command(s).
<br /><br />
See <a href="#CONFIGURATION_TEST">Configuration Tests</a> for details.
</td>

</tr><tr>
<td><code>config-test-smtpauth-username</code></td>
<td>&nbsp;</td>
<td><code>USERNAME</code></td>
<td>
While testing the configuration with <code>config-test</code>, run the commands given with
<code>smtp-auth-command</code> to test authentication
processing. Use <code>USERNAME</code> as the authentication username. This option has no
effect unless <code>config-test</code>, <code>config-test-smtpauth-password</code> and
<code>smtp-auth-command</code> are given.
<br /><br />
If <code>config-test-smtpauth-username</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>config-test-smtpauth-username</code> is not given, spamdyke will not test the authentication
command(s).
<br /><br />
See <a href="#CONFIGURATION_TEST">Configuration Tests</a> for details.
</td>

</tr><tr>
<td><code>help</code></td>
<td><code>h</code></td>
<td>&nbsp;</td>
<td>Displays a brief list of spamdyke's options, then exits.</td>

</tr><tr>
<td><code>more-help</code></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>Displays a detailed summary of spamdyke's options and their default values, then exits.</td>

</tr><tr>
<td><code>version</code></td>
<td><code>v</code></td>
<td>&nbsp;</td>
<td>Displays the spamdyke version and copyright statement, then exits.</td>

</tr>
</table>
</p><p>
The following options are valid on the command line and in configuration files.  Some options
are not valid in files within configuration directories; those options are noted below.  See
<a href="#CONFIGURATION_DIR">Configuration Directories</a> for details.
<table border=1 cellspacing=0 width=100% class="options">
<tr>
<td><b>Long Version</b></td>
<td>
<b>Short Version
<br />(command line only)</b>
</td>
<td><b>Parameter</b></td>
<td><b>Description</b></td>

</tr><tr>
<td><code>config-dir</code></td>
<td>&nbsp;</td>
<td><code>DIR</code></td>
<td>
Search the directory structure starting at <code>DIR</code> for configuration files that
match the remote server's IP address, the remote server's rDNS name, the sender's email
address, the recipient's email address or any combination of the four criteria.
<br /><br />
If <code>config-dir</code> is given multiple times, each <code>DIR</code> is scanned (in the given order)
until a match is found.
<br /><br />
If <code>config-dir</code> is not given, spamdyke will not scan any directories for
configuration files.
<br /><br />
<code>config-dir</code> is not valid within configuration directories.
<br /><br />
See <a href="#CONFIGURATION_DIR">Configuration Directories</a> for details.
</td>

</tr><tr>
<td><code>config-dir-search</code></td>
<td>&nbsp;</td>
<td>
<code>first</code>, <code>all-ip</code>,
<code>all-rdns</code>, <code>all-sender</code> or <code>all-recipient</code>
</td>
<td>
Search the directory structure given by <code>config-dir</code> using the given
search rules.
<br /><br />
If <code>config-dir-search</code> is given multiple times, the given values
are used in combination.
<br /><br />
If <code>config-dir-search</code> is not given, spamdyke will use a value of <code>first</code>.
<br /><br />
<code>config-dir-search</code> is not valid within configuration directories.
<br /><br />
See <a href="#CONFIGURATION_DIR">Configuration Directories</a> for details.
</td>

</tr><tr>
<td><code>config-file</code></td>
<td><code>f</code></td>
<td><code>FILE</code></td>
<td>
Read additional configuration options from <code>FILE</code> as though they were given on
the command line.
<br /><br />
If <code>config-file</code> is given multiple times, each <code>FILE</code> is read in
the given order.
<br /><br />
If <code>config-file</code> is not given, spamdyke will not read a configuration file.
<br /><br />
See <a href="#CONFIGURATION_FILE">Configuration Files</a> for details.
</td>

</tr><tr>
<td><code>connection-timeout-secs</code></td>
<td><code>t</code></td>
<td><code>SECS</code></td>
<td>
Forcibly disconnect after a total of <code>SECS</code> seconds, regardless of activity. A
value of <code>0</code> disables this feature.
<br /><br />
If <code>connection-timeout-secs</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>connection-timeout-secs</code> is not given, spamdyke will not enforce a connection timeout.
<br /><br />
<code>connection-timeout-secs</code> is not valid within configuration directories.
<br /><br />
See <a href="#TIMEOUTS">Timeouts</a> for details.
</td>

</tr><tr>
<td><code>dns-blacklist-entry</code></td>
<td><code>x</code></td>
<td><code>DNSRBL</code></td>
<td>
Check the remote server's IP address against the realtime blackhole list
<code>DNSRBL</code>. If it is found, the connection is rejected.
NOTE: Using more than a few DNS blacklists can cause serious performance problems.
<br /><br />
If <code>dns-blacklist-entry</code> is given multiple times, spamdyke will check each given <code>DNSRBL</code>
for the remote server's IP address.
<br /><br />
If <code>dns-blacklist-entry</code> and <code>dns-blacklist-file</code> are not given, spamdyke will not check any blackhole lists.
<br /><br />
See <a href="#DNSRBL">DNS RBLs</a> for details.
</td>

</tr><tr>
<td><code>dns-blacklist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Check the remote server's IP address against each of the realtime blackhole lists
listed in <code>FILE</code>. If it is found on any of the lists, the connection is rejected.
NOTE: Using more than a few DNS blacklists can cause serious performance problems.
<br /><br />
If <code>dns-blacklist-file</code> is given multiple times, spamdyke will check each of the blackhole lists
listed in each of the files for the remote server's IP address until a match is found.
<br /><br />
If <code>dns-blacklist-entry</code> and <code>dns-blacklist-file</code> are not given, spamdyke will not search any files for
blackhole lists.
<br /><br />
See <a href="#DNSRBL">DNS RBLs</a> for details.
</td>

</tr><tr>
<td><code>dns-level</code></td>
<td>&nbsp;</td>
<td><code>none</code>, <code>normal</code> or <code>aggressive</code></td>
<td>
<code>none</code>: Do not perform any DNS queries.  All DNS-based filters will behave as
though no response was received from any nameserver.
<br /><br />
<code>normal</code>: Send single DNS queries to one nameserver at a time and wait for
responses.  This mimics the standard system resolver library's behavior.
<br /><br />
<code>aggressive</code>: Send multiple DNS queries to multiple DNS servers simultaneously
to find answers as quickly as possible.
<br /><br />
If <code>dns-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>dns-level</code> is not given, spamdyke will use a value of <code>aggressive</code>.
<br /><br />
<code>dns-level</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-max-retries-primary</code></td>
<td>&nbsp;</td>
<td><code>NUM</code></td>
<td>
Query the primary nameserver(s) <code>NUM</code> times before also querying the
secondary nameserver(s).  If <code>NUM</code> is larger than the value of
<code>dns-max-retries-total</code>, the value of <code>dns-max-retries-total</code>
is used instead.
<br /><br />
If <code>dns-max-retries-primary</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>dns-max-retries-primary</code> is not given, spamdyke will use a value of <code>1</code>.
<br /><br />
<code>dns-max-retries-primary</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-max-retries-total</code></td>
<td>&nbsp;</td>
<td><code>NUM</code></td>
<td>
Send a maximum of <code>NUM</code> queries to any nameserver(s), primary or secondary.
<br /><br />
If <code>dns-max-retries-total</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>dns-max-retries-total</code> is not given, spamdyke will use a value of <code>3</code>.
<br /><br />
<code>dns-max-retries-total</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-query-type-a</code></td>
<td>&nbsp;</td>
<td><code>a</code> or <code>cname</code></td>
<td>
<code>a</code>: Request A records when querying for IP addresses.
<br /><br />
<code>cname</code>: Request CNAME records when querying for IP addresses.
<br /><br />
If <code>dns-query-type-a</code> is given multiple times, spamdyke will use a combination of the given values.
<br /><br />
If <code>dns-query-type-a</code> is not given, spamdyke will use a value of <code>a</code> and <code>cname</code>.
<br /><br />
<code>dns-query-type-a</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-query-type-mx</code></td>
<td>&nbsp;</td>
<td><code>a</code>, <code>cname</code> or <code>mx</code></td>
<td>
<code>a</code>: Request A records when querying for mail servers.
<br /><br />
<code>cname</code>: Request CNAME records when querying for mail servers.
<br /><br />
<code>mx</code>: Request MX records when querying for mail servers.
<br /><br />
If <code>dns-query-type-mx</code> is given multiple times, spamdyke will use a combination of the given values.
<br /><br />
If <code>dns-query-type-mx</code> is not given, spamdyke will use a value of <code>a</code>, <code>cname</code> and <code>mx</code>.
<br /><br />
<code>dns-query-type-mx</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-query-type-ptr</code></td>
<td>&nbsp;</td>
<td><code>cname</code> or <code>ptr</code></td>
<td>
<code>cname</code>: Request CNAME records when querying for reverse DNS names.
<br /><br />
<code>ptr</code>: Request PTR records when querying for reverse DNS names.
<br /><br />
If <code>dns-query-type-ptr</code> is given multiple times, spamdyke will use a combination of the given values.
<br /><br />
If <code>dns-query-type-ptr</code> is not given, spamdyke will use a value of <code>cname</code> and <code>ptr</code>.
<br /><br />
<code>dns-query-type-ptr</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-query-type-rbl</code></td>
<td>&nbsp;</td>
<td><code>a</code>, <code>cname</code> or <code>txt</code></td>
<td>
<code>a</code>: Request A records when querying DNS RBLs and DNS RHSBLs.
<br /><br />
<code>cname</code>: Request CNAME records when querying DNS RBLs and DNS RHSBLs.
<br /><br />
<code>txt</code>: Request TXT records when querying DNS RBLs and DNS RHSBLs.
<br /><br />
If <code>dns-query-type-rbl</code> is given multiple times, spamdyke will use a combination of the given values.
<br /><br />
If <code>dns-query-type-rbl</code> is not given, spamdyke will use a value of <code>a</code>, <code>cname</code> and <code>txt</code>.
<br /><br />
<code>dns-query-type-rbl</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-resolv-conf</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Read <code>FILE</code> for the list of system nameservers and other options (e.g. ports, timeouts).
<br /><br />
If <code>dns-resolv-conf</code> is given multiple times, each of the given files will be read.
<br /><br />
If <code>dns-resolv-conf</code> is not given, spamdyke
will read the list of nameservers from <code>/etc/resolv.conf</code>.
<br /><br />
<code>dns-resolv-conf</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-server-ip</code></td>
<td>&nbsp;</td>
<td><code>IPADDRESS[:PORT]</code></td>
<td>
Use <code>IPADDRESS</code> as a secondary nameserver.  If <code>PORT</code> is given, DNS
queries will be send to that port number.
<br /><br />
If <code>dns-server-ip</code> is given multiple times, each of the given nameservers will
be queried.
<br /><br />
If <code>dns-server-ip</code> and <code>dns-server-ip-primary</code> are not given, spamdyke
will read the list of nameservers from <code>/etc/resolv.conf</code>.
<br /><br />
<code>dns-server-ip</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-server-ip-primary</code></td>
<td>&nbsp;</td>
<td><code>IPADDRESS[:PORT]</code></td>
<td>
Use <code>IPADDRESS</code> as a primary nameserver.  If <code>PORT</code> is given, DNS
queries will be send to that port number.
<br /><br />
If <code>dns-server-ip-primary</code> is given multiple times, each of the given nameservers will
be queried before any secondary nameservers are queried.
<br /><br />
If <code>dns-server-ip</code> and <code>dns-server-ip-primary</code> are not given, spamdyke
will read the list of nameservers from <code>/etc/resolv.conf</code>.
<br /><br />
<code>dns-server-ip-primary</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-spoof</code></td>
<td>&nbsp;</td>
<td><code>accept-all</code>, <code>accept-same-ip</code>, <code>accept-same-port</code> or <code>reject</code></td>
<td>
<code>accept-all</code>: Do not check for UDP packet spoofing.
<br/><br/>
<code>accept-same-ip</code>: Accept UDP packets from the same IP address query packets were sent to, even if the port number is different.
<br/><br/>
<code>accept-same-port</code>: Accept UDP packets from the same port number query packets were sent to, even if the IP address is different.
<br/><br/>
<code>reject</code>: Reject all UDP packets that do not come from the same IP address and port number the query packets were sent to.
<br /><br />
If <code>dns-spoof</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>dns-spoof</code> is not given, spamdyke will use the value <code>accept-all</code>.
<br /><br />
<code>dns-spoof</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-tcp</code></td>
<td>&nbsp;</td>
<td><code>none</code> or <code>normal</code></td>
<td>
Control's whether spamdyke will perform DNS queries over TCP.  If <code>normal</code> is given,
spamdyke will use TCP for queries as needed (i.e. when a nameserver replies via UDP that a TCP
query is required).  If <code>none</code> is given, spamdyke will never use TCP for DNS queries.
<br /><br />
If <code>dns-tcp</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>dns-tcp</code> is not given, spamdyke will use the value <code>normal</code>.
<br /><br />
<code>dns-tcp</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-timeout-secs</code></td>
<td>&nbsp;</td>
<td><code>SECS</code></td>
<td>
Do not take more than a total of <code>SECS</code> seconds to perform a DNS query, including all
of the retries.
<br /><br />
If <code>dns-timeout-secs</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>dns-timeout-secs</code> is not given, spamdyke will use the value <code>30</code>.
<br /><br />
<code>dns-timeout-secs</code> is not valid within configuration directories.
<br /><br />
See <a href="#DNS_QUERIES">DNS Queries</a> for details.
</td>

</tr><tr>
<td><code>dns-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>DNSWHITELIST</code></td>
<td>
Check the remote server's IP address against the DNS whitelist <code>DNSWHITELIST</code>
(essentially a DNSRBL that contains whitelisted IPs). If it is found, all
filters are bypassed.
NOTE: Using more than a few DNS whitelists can cause serious performance problems.
<br /><br />
If <code>dns-whitelist-entry</code> is given multiple times, spamdyke will check each given
<code>DNSWHITELIST</code> for the remote server's IP address.
<br /><br />
If <code>dns-whitelist-entry</code> and <code>dns-whitelist-file</code> are not given,
spamdyke will not check any DNS whitelists.
<br /><br />
See <a href="#DNSWHITELISTS">DNS Whitelists</a> for details.
</td>

</tr><tr>
<td><code>dns-whitelist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Check the remote server's IP address against each of the DNS whitelists
(essentially a DNSRBL that contains whitelisted IPs) listed in <code>FILE</code>.
If it is found on any of the lists, all filters are bypassed.
NOTE: Using more than a few DNS whitelists can cause serious performance problems.
<br /><br />
If <code>dns-whitelist-file</code> is given multiple times, spamdyke will check each 
DNS whitelist listed in each given <code>FILE</code> for the remote server's IP address.
<br /><br />
If <code>dns-whitelist-entry</code> and <code>dns-whitelist-file</code> are not given,
spamdyke will not check any DNS whitelists.
<br /><br />
See <a href="#DNSWHITELISTS">DNS Whitelists</a> for details.
</td>

</tr><tr>
<td><code>filter-level</code></td>
<td>&nbsp;</td>
<td><code>allow-all</code>, <code>normal</code>, <code>require-auth</code> or <code>reject-all</code></td>
<td>
<code>allow-all</code>: Allow all connections to bypass all filters, effectively whitelisting everything.
<br /><br />
<code>normal</code>: Apply enabled filters according to the options on the command line and in the configuration file(s).
<br /><br />
<code>require-auth</code>: Reject all connections that haven't authenticated using SMTP AUTH.
<br /><br />
<code>reject-all</code>: Reject all connections, regardless of authentication or whitelists.
<br /><br />
If <code>filter-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>filter-level</code> is not given, spamdyke will use a value of <code>normal</code>.
<br /><br />
See <a href="#FILTER_LEVELS">Filter Levels</a> for details.
</td>

</tr><tr>
<td><code>full-log-dir</code></td>
<td><code>L</code></td>
<td><code>DIR</code></td>
<td>
Log all SMTP data to files in <code>DIR</code>. This is handy for troubleshooting delivery
problems but it is not meant to be used long-term. This option imposes a performance
penalty!
<br /><br />
If <code>full-log-dir</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>full-log-dir</code> is not given, spamdyke will not log all SMTP data.
<br /><br />
<code>full-log-dir</code> is not valid within configuration directories.
<br /><br />
See <a href="#FULL_LOGGING">Logging All Data</a> for details.
</td>

</tr><tr>
<td><code>graylist-dir</code></td>
<td><code>g</code></td>
<td><code>DIR</code></td>
<td>
Search for and create graylist files in directory structures within <code>DIR</code>.
This option has no effect unless <code>graylist-level</code> is given.
<br /><br />
If <code>graylist-dir</code> is given multiple times, spamdyke will search each given directory in the given order for the
recipient's domain directory and stop when it finds the first one.
<br /><br />
If <code>graylist-dir</code> is not given, spamdyke will not graylist connections.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-exception-ip-entry</code></td>
<td>&nbsp;</td>
<td><code>IPADDRESS</code></td>
<td>
Reverse the behavior of the graylist filter for remote servers whose IP
addresses match <code>IPADDRESS</code>.  This option has no effect
unless <code>graylist-level</code> and <code>graylist-dir</code> are given.
<br /><br />
If <code>graylist-exception-ip-entry</code> is given multiple times, spamdyke will match the remote server's IP address
against given <code>IPADDRESS</code>.
<br /><br />
If <code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> and
<code>graylist-exception-rdns-file</code> are not given, spamdyke will graylist each connection according to the
value of <code>graylist-level</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-exception-ip-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Reverse the behavior of the graylist filter for remote servers whose IP
addresses match entries in <code>FILE</code>.  This option provides better
performance than <code>graylist-exception-ip-entry</code> for more than a few
entries.  This option has no effect
unless <code>graylist-level</code> and <code>graylist-dir</code> are given.
<br /><br />
If <code>graylist-exception-ip-file</code> is given multiple times, spamdyke will match the remote server's IP address
against each entry in each given <code>FILE</code>.
<br /><br />
If <code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> and
<code>graylist-exception-rdns-file</code> are not given, spamdyke will graylist each connection according to the
value of <code>graylist-level</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-exception-rdns-dir</code></td>
<td>&nbsp;</td>
<td><code>DIR</code></td>
<td>
Reverse the behavior of the graylist filter for remote servers whose rDNS names
match files in <code>DIR</code>.  This option provides much better performance
than <code>graylist-exception-rdns-file</code> for large numbers of entries.
This option has no effect
unless <code>graylist-level</code> and <code>graylist-dir</code> are given.
<br /><br />
If <code>graylist-exception-rdns-dir</code> is given multiple times, spamdyke will
search each <code>DIR</code> for files that match the remote server's rDNS name.
<br /><br />
If <code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> and
<code>graylist-exception-rdns-file</code> are not given, spamdyke will graylist each connection according to the
value of <code>graylist-level</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-exception-rdns-entry</code></td>
<td>&nbsp;</td>
<td><code>RDNSNAME</code></td>
<td>
Reverse the behavior of the graylist filter for remote servers whose rDNS names
match <code>RDNSNAME</code>.  This option has no effect
unless <code>graylist-level</code> and <code>graylist-dir</code> are given.
<br /><br />
If <code>graylist-exception-rdns-entry</code> is given multiple times, spamdyke will
match the remote server's rDNS name against each given <code>RDNSNAME</code>.
<br /><br />
If <code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> and
<code>graylist-exception-rdns-file</code> are not given, spamdyke will graylist each connection according to the
value of <code>graylist-level</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-exception-rdns-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Reverse the behavior of the graylist filter for remote servers whose rDNS names
match entries in <code>FILE</code>.  This option provides better performance
than <code>graylist-exception-rdns-entry</code> for more than a few entries.
This option has no effect
unless <code>graylist-level</code> and <code>graylist-dir</code> are given.
<br /><br />
If <code>graylist-exception-rdns-file</code> is given multiple times, spamdyke will
match the remote server's rDNS name against each entry in each given <code>FILE</code>.
<br /><br />
If <code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> and
<code>graylist-exception-rdns-file</code> are not given, spamdyke will graylist each connection according to the
value of <code>graylist-level</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-level</code></td>
<td>&nbsp;</td>
<td><code>none</code>,
<code>always</code>,
<code>always-create-dir</code>,
<code>only</code> or
<code>only-create-dir</code></td>
<td>
<code>none</code>: Do not graylist any connections.
<br /><br />
<code>always</code>: Graylist all connections that have an existing recipient domain directory,
except those that match one of the options
<code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> or
<code>graylist-exception-rdns-file</code>.
If the <code>qmail-rcpthosts-file</code> value is invalid, this value has no effect.
<br /><br />
<code>always-create-dir</code>: Graylist all connections
except those that match one of the options
<code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> or
<code>graylist-exception-rdns-file</code>.
If the recipient's domain directory does not exist, create it.
If the <code>qmail-rcpthosts-file</code> value is invalid, this value has no effect.
<br /><br />
<code>only</code>: Do not graylist any connections unless the recipient's domain directory exists and
the connection matches one of the options
<code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> or
<code>graylist-exception-rdns-file</code>.
If the <code>qmail-rcpthosts-file</code> value is invalid, this value has no effect.
<br /><br />
<code>only-create-dir</code>: Do not graylist any connections unless
it matches one of the options
<code>graylist-exception-ip-entry</code>,
<code>graylist-exception-ip-file</code>,
<code>graylist-exception-rdns-dir</code>,
<code>graylist-exception-rdns-entry</code> or
<code>graylist-exception-rdns-file</code>.
If the recipient's domain directory does not exist, create it.
If the <code>qmail-rcpthosts-file</code> value is invalid, this value has no effect.
<br /><br />
If <code>graylist-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>graylist-level</code> is not given, spamdyke will use a value of <code>none</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-max-secs</code></td>
<td><code>M</code></td>
<td><code>SECS</code></td>
<td>
Invalidate graylist entries after they are <code>SECS</code> seconds old.
A value of <code>0</code> prevents graylist entries from ever expiring.
Requires <code>graylist-dir</code> and <code>graylist-level</code>.
<br /><br />
If <code>graylist-max-secs</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>graylist-max-secs</code> is not given, spamdyke will use a value of <code>0</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>graylist-min-secs</code></td>
<td><code>m</code></td>
<td><code>SECS</code></td>
<td>
Require a graylist entry to be present for <code>SECS</code> seconds before allowing
incoming mail.
A value of <code>0</code> will not require any delay; mail will be accepted in any connection
immediately after the initial graylisting.
Requires <code>graylist-dir</code> and <code>graylist-level</code>.
<br /><br />
If <code>graylist-min-secs</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>graylist-min-secs</code> is not given, spamdyke will use a value of <code>0</code>.
<br /><br />
See <a href="#GRAYLISTS">Graylisting / Greylisting</a> for details.
</td>

</tr><tr>
<td><code>greeting-delay-secs</code></td>
<td><code>e</code></td>
<td><code>SECS</code></td>
<td>
Delay sending the SMTP greeting banner <code>SECS</code> seconds to see if the remote server
begins sending data early. If it does, the connection is rejected.
<br /><br />
If <code>greeting-delay-secs</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>greeting-delay-secs</code> is not given, spamdyke will use a value of <code>0</code>.
<br /><br />
See <a href="#EARLYTALKERS">Earlytalkers</a> for details.
</td>

</tr><tr>
<td><code>header-blacklist-entry</code></td>
<td>&nbsp;</td>
<td><code>VALUE</code></td>
<td>
Reject any message with a header line that matches <code>VALUE</code>.
<br /><br />
If <code>header-blacklist-entry</code> is given multiple times, spamdyke will match the message
headers against each <code>VALUE</code> given.
<br /><br />
If <code>header-blacklist-entry</code> and <code>header-blacklist-file</code> are not given,
spamdyke will not filter any message based on their header content.
<br /><br />
<code>header-blacklist-entry</code> is valid within configuration directories but entries found
there accumulate and apply to all recipients, not just one.
<br /><br />
See <a href="#HEADERS">Rejecting Messages by Header Content</a> for details.
</td>

</tr><tr>
<td><code>header-blacklist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Reject any message with a header line that matches a line in <code>FILE</code>.
<br /><br />
If <code>header-blacklist-file</code> is given multiple times, spamdyke will match the message
headers against each line in each given <code>FILE</code>.
<br /><br />
If <code>header-blacklist-entry</code> and <code>header-blacklist-file</code> are not given,
spamdyke will not filter any message based on their header content.
<br /><br />
<code>header-blacklist-file</code> is valid within configuration directories but entries found
there accumulate and apply to all recipients, not just one.
<br /><br />
See <a href="#HEADERS">Rejecting Messages by Header Content</a> for details.
</td>

</tr><tr>
<td><code>hostname</code></td>
<td>&nbsp;</td>
<td><code>NAME</code></td>
<td>
Use <code>NAME</code> as the fully qualified domain name of this host. This value is only
used to create an encrypted challenge during SMTP AUTH challenge-response protocols.
<br /><br />
If <code>hostname</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>hostname</code>, <code>hostname-command</code> and <code>hostname-file</code> are
empty, spamdyke will search for the host's name in the environment or will use a default name.
<br /><br />
<code>hostname</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_AUTH">SMTP AUTH</a> for details.
</td>

</tr><tr>
<td><code>hostname-command</code></td>
<td>&nbsp;</td>
<td><code>COMMAND</code></td>
<td>
Read the fully qualified domain name of this host from the output of <code>COMMAND</code>.
Most often, this value is <code>/bin/hostname -f</code>. This value is only used to create
an encrypted challenge during SMTP AUTH challenge-response protocols. This option is
ignored if <code>hostname</code> or <code>hostname-file</code> are given.
<br /><br />
If <code>hostname-command</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>hostname</code>, <code>hostname-command</code> and <code>hostname-file</code> are
empty, spamdyke will search for the host's name in the environment or will use a default name.
<br /><br />
<code>hostname-command</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_AUTH">SMTP AUTH</a> for details.
</td>

</tr><tr>
<td><code>hostname-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Read the fully qualified domain name of this host from the first line of <code>FILE</code>.
This value is only used to create an encrypted challenge during SMTP AUTH
challenge-response protocols. This option is ignored if <code>hostname</code> is given.
<br /><br />
If <code>hostname-file</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>hostname-file</code> is not given, spamdyke will use a value of <code>/var/qmail/control/me</code>.
<br /><br />
If <code>hostname</code>, <code>hostname-command</code> and <code>hostname-file</code> are
empty, spamdyke will search for the host's name in the environment or will use a default name.
<br /><br />
<code>hostname-file</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_AUTH">SMTP AUTH</a> for details.
</td>

</tr><tr>
<td><code>idle-timeout-secs</code></td>
<td><code>T</code></td>
<td><code>SECS</code></td>
<td>
Forcibly disconnect after <code>SECS</code> seconds of inactivity. A value of <code>0</code> disables
this feature.
<br /><br />
If <code>idle-timeout-secs</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>idle-timeout-secs</code> is not given, spamdyke will use a value of <code>0</code>.
<br /><br />
<code>idle-timeout-secs</code> is not valid within configuration directories.
<br /><br />
See <a href="#TIMEOUTS">Timeouts</a> for details.
</td>

</tr><tr>
<td><code>ip-blacklist-entry</code></td>
<td>&nbsp;</td>
<td><code>IPADDRESS</code></td>
<td>
Reject the connection if the remote server's IP address matches <code>IPADDRESS</code>.
<br /><br />
If <code>ip-blacklist-entry</code> is given multiple times, spamdyke will check the remote server's IP address
against each given <code>IPADDRESS</code>.
<br /><br />
If <code>ip-blacklist-entry</code> and <code>ip-blacklist-file</code> are not given, spamdyke will not attempt
to match the remote server's IP address against blacklist entries.
<br /><br />
See <a href="#BLACKLISTS">Blacklists</a> for details.
</td>

</tr><tr>
<td><code>ip-blacklist-file</code></td>
<td><code>B</code></td>
<td><code>FILE</code></td>
<td>
Reject the connection if the remote server's IP address matches an entry in
<code>FILE</code>.  This option provides better performance than <code>ip-blacklist-entry</code>
for more than a few entries.
<br /><br />
If <code>ip-blacklist-file</code> is given multiple times, spamdyke will check the remote server's IP address
against each entry in each given <code>FILE</code>.
<br /><br />
If <code>ip-blacklist-entry</code> and <code>ip-blacklist-file</code> are not given, spamdyke will not attempt
to match the remote server's IP address against blacklist entries.
<br /><br />
See <a href="#BLACKLISTS">Blacklists</a> for details.
</td>

</tr><tr>
<td><code>ip-in-rdns-keyword-blacklist-entry</code></td>
<td>&nbsp;</td>
<td><code>KEYWORD</code></td>
<td>
Search the remote server's rDNS name for its IP address <b>and</b> <code>KEYWORD</code>.
If both are found, reject the connection.
<br /><br />
If <code>ip-in-rdns-keyword-blacklist-entry</code> is given multiple times, spamdyke will
search the remote server's rDNS name for its IP address and each given <code>KEYWORD</code>.
<br /><br />
If <code>ip-in-rdns-keyword-blacklist-entry</code> and <code>ip-in-rdns-keyword-blacklist-file</code>
are not given, spamdyke will not reject connections because the remote server's rDNS name contains
its IP address.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>ip-in-rdns-keyword-blacklist-file</code></td>
<td><code>k</code></td>
<td><code>FILE</code></td>
<td>
Search the remote server's rDNS name for its IP address <b>and</b> a keyword listed in <code>FILE</code>.
If both are found, reject the connection.
This option provides better performance than <code>ip-in-rdns-keyword-whitelist-entry</code> for
more than a few entries.
<br /><br />
If <code>ip-in-rdns-keyword-blacklist-file</code> is given multiple times, spamdyke will
search the remote server's rDNS name for its IP address and each keyword listed in each given <code>FILE</code>.
<br /><br />
If <code>ip-in-rdns-keyword-blacklist-entry</code> and <code>ip-in-rdns-keyword-blacklist-file</code>
are not given, spamdyke will not reject connections because the remote server's rDNS name contains
its IP address.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>ip-in-rdns-keyword-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>KEYWORD</code></td>
<td>
Search the remote server's rDNS name for its IP address <b>and</b> <code>KEYWORD</code>.
If both are found, bypass all filters.
<br /><br />
If <code>ip-in-rdns-keyword-whitelist-entry</code> is given multiple times, spamdyke will
search the remote server's rDNS name for its IP address and each given <code>KEYWORD</code>.
<br /><br />
If <code>ip-in-rdns-keyword-whitelist-entry</code> and <code>ip-in-rdns-keyword-whitelist-file</code>
are not given, spamdyke will not bypass all filters because the remote server's rDNS name contains
its IP address.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>ip-in-rdns-keyword-whitelist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Search the remote server's rDNS name for its IP address <b>and</b> a keyword listed in <code>FILE</code>.
If both are found, bypass all filters.
This option provides better performance than <code>ip-in-rdns-keyword-whitelist-entry</code> for
more than a few entries.
<br /><br />
If <code>ip-in-rdns-keyword-whitelist-file</code> is given multiple times, spamdyke will
search the remote server's rDNS name for its IP address and each keyword listed in each given <code>FILE</code>.
<br /><br />
If <code>ip-in-rdns-keyword-whitelist-entry</code> and <code>ip-in-rdns-keyword-whitelist-file</code>
are not given, spamdyke will not bypass all filters because the remote server's rDNS name contains
its IP address.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>ip-relay-entry</code></td>
<td>&nbsp;</td>
<td><code>IPADDRESS</code></td>
<td>
Allow connections from the IP address <code>IPADDRESS</code> to relay messages (i.e. send messages to non-local recipients).
<br /><br />
If <code>ip-relay-entry</code> is given multiple times, spamdyke will check the remote server's IP address
against each given <code>IPADDRESS</code>.
<br /><br />
If <code>ip-relay-entry</code> and <code>ip-relay-file</code> are not given, spamdyke will not allow
specific connections to relay according to their IP addresses.
<br /><br />
See <a href="#RELAYING">Relaying</a> for details.
</td>

</tr><tr>
<td><code>ip-relay-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Allow connections from the IP addresses in the file <code>FILE</code> to relay messages (i.e. send messages to non-local recipients).
This option provides better performance than <code>ip-relay-entry</code> for more than a few entries.
<br /><br />
If <code>ip-relay-file</code> is given multiple times, spamdyke will check the remote server's IP address
against each entry in each given <code>FILE</code>.
<br /><br />
If <code>ip-relay-entry</code> and <code>ip-relay-file</code> are not given, spamdyke will not allow
specific connections to relay according to their IP addresses.
<br /><br />
See <a href="#RELAYING">Relaying</a> for details.
</td>

</tr><tr>
<td><code>ip-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>IPADDRESS</code></td>
<td>
If the remote server's IP address matches <code>IPADDRESS</code>, bypass all filters.
<br /><br />
If <code>ip-whitelist-entry</code> is given multiple times, spamdyke will check the remote server's
IP address against each given <code>IPADDRESS</code>.
<br /><br />
If <code>ip-whitelist-entry</code> and <code>ip-whitelist-file</code> are not given, spamdyke will
not attempt to match the remote server's IP address against whitelist entries.
<br /><br />
See <a href="#WHITELISTS">Whitelists</a> for details.
</td>

</tr><tr>
<td><code>ip-whitelist-file</code></td>
<td><code>W</code></td>
<td><code>FILE</code></td>
<td>
If the remote server's IP address matches an entry in <code>FILE</code>, bypass all filters.
This option provides better performance than <code>ip-whitelist-entry</code> for more than a few entries.
<br /><br />
If <code>ip-whitelist-file</code> is given multiple times, spamdyke will check the remote server's
IP address against each entry in each given <code>FILE</code>.
<br /><br />
If <code>ip-whitelist-entry</code> and <code>ip-whitelist-file</code> are not given, spamdyke will
not attempt to match the remote server's IP address against whitelist entries.
<br /><br />
See <a href="#WHITELISTS">Whitelists</a> for details.
</td>

</tr><tr>
<td><code>log-level</code></td>
<td><code>l</code> (lowercase ell)</td>
<td>
<code>none</code>,
<code>error</code>,
<code>info</code>,
<code>verbose</code>,
<code>debug</code> or
<code>excessive</code>
</td>
<td>
<code>none</code>: No logging.
<br /><br />
<code>error</code>: Log errors only.
<br /><br />
<code>info</code>: Everything from <code>error</code> plus connection messages.
<br /><br />
<code>verbose</code>: Everything from <code>info</code> plus non-critical errors such as
network errors caused by the remote host, protocol errors, config-test status messages
and child process error messages.
<br /><br />
<code>debug</code>: Everything from <code>verbose</code> plus high-level debugging messages
to show the processing path within spamdyke.
<br /><br />
<code>excessive</code>: Everything from <code>debug</code> plus low-level debugging messages
to show data values and small status messages within spamdyke.
<br /><br />
If <code>log-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>log-level</code> is not given, spamdyke will use a value of <code>error</code>.
<br /><br />
<code>log-level</code> is not valid within configuration directories.
<br /><br />
See <a href="#LOG">Log Messages</a> for details.
</td>

</tr><tr>
<td><code>log-target</code></td>
<td>&nbsp;</td>
<td><code>stderr</code> or <code>syslog</code></td>
<td>
<code>stderr</code>: Send log messages to standard error (stderr).
<br /><br />
<code>syslog</code>: Send log messages to the system log file via syslogd.
<br /><br />
If <code>log-target</code> is given multiple times, spamdyke will use a combination of the given values.
<br /><br />
If <code>log-target</code> is not given, spamdyke will use a value of <code>syslog</code>.
<br /><br />
<code>log-target</code> is not valid within configuration directories.
<br /><br />
See <a href="#LOG">Log Messages</a> for details.
</td>

</tr><tr>
<td><code>max-recipients</code></td>
<td><code>a</code></td>
<td><code>NUM</code></td>
<td>
Allow a maximum of <code>NUM</code> recipients per connection.
<br /><br />
If <code>max-recipients</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>max-recipients</code> is not given, spamdyke will not limit the number of recipients.
<br /><br />
<code>max-recipients</code> is not valid within configuration directories.
<br /><br />
See <a href="#MAXRECIPIENTS">Limiting Numbers of Recipients</a> for details.
</td>

</tr><tr>
<td><code>policy-url</code></td>
<td><code>u</code></td>
<td><code>URL</code></td>
<td>
Append <code>URL</code> to the rejection message to explain why the rejection occurred.
NOTE: most servers hide rejection messages from their users and most users
don't read bounce messages. Maximum 100 characters.
<br /><br />
If <code>policy-url</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>policy-url</code> is not given, spamdyke will not append a URL to the rejection message.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>qmail-morercpthosts-cdb</code></td>
<td>&nbsp;</td>
<td><code>CDB</code></td>
<td>
Search the "constant database" (CDB) file <code>CDB</code> for a list of domains for which email is accepted on this server.
This value should always be the same as qmail's "morercpthosts" CDB.
If this file isn't the same file qmail uses, spamdyke will be unable to correctly determine if an address is "local" or not, which may result in erroneous behavior.
<b>NOTE:</b> do not change this option's default value unless you <b>really</b> know what you're doing.
<br /><br />
If <code>qmail-morercpthosts-cdb</code> is given multiple times, spamdyke will search each file.
qmail does not do this, so providing multiple values is not recommended.
<br /><br />
If the value of <code>qmail-morercpthosts-cdb</code> is invalid, spamdyke won't be able to validate recipient addresses.
<br /><br />
If <code>qmail-morercpthosts-cdb</code> is not given, spamdyke will use the value <code>/var/qmail/control/morercpthosts.cdb</code>.
<br /><br />
<code>qmail-morercpthosts-cdb</code> is not valid within configuration directories.
<br /><br />
See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</td>

</tr><tr>
<td><code>qmail-rcpthosts-file</code></td>
<td><code>d</code></td>
<td><code>FILE</code></td>
<td>
Search <code>FILE</code> for a list of domains for which email is accepted on this server.
This value should always be the same as qmail's "rcpthosts" file.
If this file isn't the same file qmail uses, spamdyke will be unable to correctly determine if an address is "local" or not, which may result in erroneous behavior.
<b>NOTE:</b> do not change this option's default value unless you <b>really</b> know what you're doing.
<br /><br />
If <code>qmail-rcpthosts-file</code> is given multiple times, spamdyke will search each file.
qmail does not do this, so providing multiple values is not recommended.
<br /><br />
If the value of <code>qmail-rcpthosts-file</code> is invalid, spamdyke
will disable all filters that depend on determining "local" addresses and won't be able to validate recipient addresses.
<br /><br />
If <code>qmail-rcpthosts-file</code> is not given, spamdyke will use the value <code>/var/qmail/control/rcpthosts</code>.
<br /><br />
<code>qmail-morercpthosts-cdb</code> is not valid within configuration directories.
<br /><br />
See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</td>

</tr><tr>
<td><code>rdns-blacklist-dir</code></td>
<td><code>b</code></td>
<td><code>DIR</code></td>
<td>
Reject the connection if the remote server's rDNS name matches a file in <code>DIR</code>.
This option provides better performance than <code>rdns-blacklist-file</code> for
large numbers of entries.
<br /><br />
If <code>rdns-blacklist-dir</code> is given multiple times, spamdyke will search each <code>DIR</code>
for files that match the remote server's rDNS name.
<br /><br />
If <code>rdns-blacklist-dir</code>, <code>rdns-blacklist-entry</code> and <code>rdns-blacklist-file</code>
are not given, spamdyke will not attempt to match the remote server's rDNS name against blacklist entries.
<br /><br />
See <a href="#BLACKLISTS">Blacklists</a> for details.
</td>

</tr><tr>
<td><code>rdns-blacklist-entry</code></td>
<td>&nbsp;</td>
<td><code>DOMAIN</code></td>
<td>
Reject the connection if the remote server's rDNS name matches <code>DOMAIN</code>.
<br /><br />
If <code>rdns-blacklist-entry</code> is given multiple times, spamdyke will attempt to match the remote
server's rDNS name against each given <code>DOMAIN</code>.
<br /><br />
If <code>rdns-blacklist-dir</code>, <code>rdns-blacklist-entry</code> and <code>rdns-blacklist-file</code>
are not given, spamdyke will not attempt to match the remote server's rDNS name against blacklist entries.
<br /><br />
See <a href="#BLACKLISTS">Blacklists</a> for details.
</td>

</tr><tr>
<td><code>rdns-blacklist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Reject the connection if the remote server's rDNS name matches an entry in <code>FILE</code>.
This option provides better performance than <code>rdns-blacklist-entry</code> for more than a few entries.
<br /><br />
If <code>rdns-blacklist-file</code> is given multiple times, spamdyke will search each given <code>FILE</code>
for entries that match the remote server's rDNS name.
<br /><br />
If <code>rdns-blacklist-dir</code>, <code>rdns-blacklist-entry</code> and <code>rdns-blacklist-file</code>
are not given, spamdyke will not attempt to match the remote server's rDNS name against blacklist entries.
<br /><br />
See <a href="#BLACKLISTS">Blacklists</a> for details.
</td>

</tr><tr>
<td><code>rdns-relay-entry</code></td>
<td>&nbsp;</td>
<td><code>DOMAIN</code></td>
<td>
Allow relaying (i.e. sending to non-local recipients) if the remote server's rDNS name matches <code>DOMAIN</code>.
<br /><br />
If <code>rdns-relay-entry</code> is given multiple times, spamdyke will check the remote server's rDNS name
against each given <code>DOMAIN</code>.
<br /><br />
If <code>rdns-relay-entry</code> and <code>rdns-relay-file</code> are not given, spamdyke will not allow
specific connections to relay according to their rDNS names.
<br /><br />
See <a href="#RELAYING">Relaying</a> for details.
</td>

</tr><tr>
<td><code>rdns-relay-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Allow relaying (i.e. sending to non-local recipients) if the remote server's rDNS name matches any entry in <code>FILE</code>.
This option provides better performance than <code>rdns-relay-entry</code> for more than a few entries.
<br /><br />
If <code>rdns-relay-file</code> is given multiple times, spamdyke will check the remote server's rDNS name
against each entry in each given <code>FILE</code>.
<br /><br />
If <code>rdns-relay-entry</code> and <code>rdns-relay-file</code> are not given, spamdyke will not allow
specific connections to relay according to their rDNS names.
<br /><br />
See <a href="#RELAYING">Relaying</a> for details.
</td>

</tr><tr>
<td><code>rdns-whitelist-dir</code></td>
<td>&nbsp;</td>
<td><code>DIR</code></td>
<td>
If the remote server's rDNS name matches a file in <code>DIR</code>, bypass all filters.
This option provides better performance than <code>rdns-whitelist-file</code> for
large numbers of entries.
<br /><br />
If <code>rdns-whitelist-dir</code> is given multiple times, spamdyke will search each <code>DIR</code>
for files that match the remote server's rDNS name.
<br /><br />
If <code>rdns-whitelist-dir</code>, <code>rdns-whitelist-entry</code> and <code>rdns-whitelist-file</code>
are not given, spamdyke will not attempt to match the remote server's rDNS name against whitelist entries.
<br /><br />
See <a href="#WHITELISTS">Whitelists</a> for details.
</td>

</tr><tr>
<td><code>rdns-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>DOMAIN</code></td>
<td>
If the remote server's rDNS name matches <code>DOMAIN</code>, bypass all filters.
<br /><br />
If <code>rdns-whitelist-entry</code> is given multiple times, spamdyke will attempt to match the remote
server's rDNS name against each given <code>DOMAIN</code>.
<br /><br />
If <code>rdns-whitelist-dir</code>, <code>rdns-whitelist-entry</code> and <code>rdns-whitelist-file</code>
are not given, spamdyke will not attempt to match the remote server's rDNS name against whitelist entries.
<br /><br />
See <a href="#WHITELISTS">Whitelists</a> for details.
</td>

</tr><tr>
<td><code>rdns-whitelist-file</code></td>
<td><code>w</code></td>
<td><code>FILE</code></td>
<td>
If the remote server's rDNS name matches an entry in <code>FILE</code>, bypass all filters.
This option provides better performance than <code>rdns-whitelist-entry</code> for more than a few entries.
<br /><br />
If <code>rdns-whitelist-file</code> is given multiple times, spamdyke will search each given <code>FILE</code>
for entries that match the remote server's rDNS name.
<br /><br />
If <code>rdns-whitelist-dir</code>, <code>rdns-whitelist-entry</code> and <code>rdns-whitelist-file</code>
are not given, spamdyke will not attempt to match the remote server's rDNS name against whitelist entries.
<br /><br />
See <a href="#WHITELISTS">Whitelists</a> for details.
</td>

</tr><tr>
<td><code>recipient-blacklist-entry</code></td>
<td>&nbsp;</td>
<td><code>ADDRESS</code></td>
<td>
Reject any recipient addresses that match <code>ADDRESS</code>.
<br /><br />
If <code>recipient-blacklist-entry</code> is given multiple times, spamdyke will attempt to match
each recipient address against each given <code>ADDRESS</code>.
<br /><br />
If <code>recipient-blacklist-entry</code> and <code>recipient-blacklist-file</code> are not given,
spamdyke will not attempt to match recipient addresses against blacklist entries.
<br /><br />
See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</td>

</tr><tr>
<td><code>recipient-blacklist-file</code></td>
<td><code>S</code></td>
<td><code>FILE</code></td>
<td>
Reject any recipient addresses that match entries in <code>FILE</code>.
This option provides better performance than <code>recipient-blacklist-entry</code> for
more than a few entries.
<br /><br />
If <code>recipient-blacklist-file</code> is given multiple times, spamdyke will attempt to match
each recipient address against each entry in each given <code>FILE</code>.
<br /><br />
If <code>recipient-blacklist-entry</code> and <code>recipient-blacklist-file</code> are not given,
spamdyke will not attempt to match recipient addresses against blacklist entries.
<br /><br />
See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</td>

</tr><tr>
<td><code>recipient-validation-command</code></td>
<td>&nbsp;</td>
<td><code>COMMAND</code></td>
<td>
Execute command <code>COMMAND</code> when a recipient address needs to be validated (i.e. when <code>reject-recipient</code> is <code>invalid</code>, <code>unavailable</code> or both).
<code>COMMAND</code> should be the full path to a setuid binary of the "spamdyke-qrv" utility.
<br /><br />
If <code>recipient-validation-command</code> is given multiple times, spamdyke will execute each binary
in order until a definite answer is returned from the command (e.g. "valid" or "invalid" or "unavailable").
<br /><br />
If <code>recipient-validation-command</code> is not given, spamdyke will not attempt to validate recipient addresses.
<br /><br />
See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</td>

</tr><tr>
<td><code>recipient-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>ADDRESS</code></td>
<td>
If the recipient's address matches <code>ADDRESS</code>, bypass all filters.
<br /><br />
If <code>recipient-whitelist-entry</code> is given multiple times, spamdyke will attempt to match
each recipient address against each given <code>ADDRESS</code>.
<br /><br />
If <code>recipient-whitelist-entry</code> and <code>recipient-whitelist-file</code> are not given,
spamdyke will not attempt to match recipient addresses against whitelist entries.
<br /><br />
See <a href="#WHITELISTING_ADDRESSES">Whitelisting Senders and Recipients</a> for details.
</td>

</tr><tr>
<td><code>recipient-whitelist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
If the recipient's email address matches an entry in <code>FILE</code>, bypass all filters.
This option provides better performance than <code>recipient-whitelist-entry</code> for
more than a few entries.
<br /><br />
If <code>recipient-whitelist-file</code> is given multiple times, spamdyke will attempt to match
each recipient address against each entry in each given <code>FILE</code>.
<br /><br />
If <code>recipient-whitelist-entry</code> and <code>recipient-whitelist-file</code> are not given,
spamdyke will not attempt to match recipient addresses against whitelist entries.
<br /><br />
See <a href="#WHITELISTING_ADDRESSES">Whitelisting Senders and Recipients</a> for details.
</td>

</tr><tr>
<td><code>reject-empty-rdns</code></td>
<td><code>r</code></td>
<td>
<i>optional:</i><br />
<code>0</code>,
<code>1</code>,
<code>false</code>,
<code>true</code>,
<code>no</code> or
<code>yes</code>
</td>
<td>
Reject the connection if the remote server has no rDNS name.
<br /><br />
If <code>reject-empty-rdns</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>reject-empty-rdns</code> is not given, spamdyke will not reject connections with missing rDNS names.
<br /><br />
If <code>reject-empty-rdns</code> is given without an argument, spamdyke will use a value of <code>yes</code>.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>reject-ip-in-cc-rdns</code></td>
<td><code>c</code></td>
<td>
<i>optional:</i><br />
<code>0</code>,
<code>1</code>,
<code>false</code>,
<code>true</code>,
<code>no</code> or
<code>yes</code>
</td>
<td>
Search the remote server's rDNS name for its IP address <b>and</b> a two-letter
country code. If both are found, reject the connection.
<br /><br />
If <code>reject-ip-in-cc-rdns</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>reject-ip-in-cc-rdns</code> is not given, spamdyke will not reject connections from servers
whose rDNS names contain their IP address and a country code.
<br /><br />
If <code>reject-ip-in-cc-rdns</code> is given without an argument, spamdyke will use a value of <code>yes</code>.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>reject-recipient</code></td>
<td>&nbsp;</td>
<td>
<code>none</code>,
<code>same-as-sender</code>,
<code>invalid</code> or
<code>unavailable</code>
</td>
<td>
<code>none</code>: Deactivate this option's filters.
<br /><br />
<code>same-as-sender</code>: Reject any recipient address that is the same as the sender address.
<br /><br />
<code>invalid</code>: Reject any recipient address that will never result in a successful delivery (e.g. any address qmail will accept and later bounce).
<b>NOTE:</b> this value is ignored unless <code>recipient-validation-command</code> is also given.
<br /><br />
<code>unavailable</code>: Reject any recipient address that is currently unavailable (due to file permissions or other settings).
<b>NOTE:</b> this value is ignored unless <code>recipient-validation-command</code> is also given.
<br /><br />
If <code>reject-identical-sender-recipient</code> is given multiple times, spamdyke will use every value it finds.
<br /><br />
If <code>reject-identical-sender-recipient</code> is not given, spamdyke will use the value <code>none</code>.
<br /><br />
See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</td>

</tr><tr>
<td><code>reject-sender</code></td>
<td>&nbsp;</td>
<td>
<code>none</code>,
<code>no-mx</code>,
<code>not-local</code>,
<code>authentication-mismatch</code>, or
<code>authentication-domain-mismatch</code>
</td>
<td>
<code>none</code>: Deactivate this option's filters.
<br /><br />
<code>no-mx</code>: Reject any connection where the sender's domain name does not have a valid mail exchanger (an MX record or an A record).
<br /><br />
<code>not-local</code>: Reject connections where the sender's domain is not local (i.e. not hosted on the local server).
Values for the options <code>qmail-rcpthosts-file</code> or <code>qmail-morercpthosts-cdb</code> are required.
<br /><br />
<code>authentication-mismatch</code>: Reject connections where the sender's address (user and domain) does not match the username used during authentication.
<b>NOTE:</b> This value has no effect if the sender does not authenticate.
<br /><br />
<code>authentication-domain-mismatch</code>: Reject connections where the sender's domain does not match the domain used during authentication.
<b>NOTE:</b> This value has no effect if the sender does not authenticate or if the authentication username is not an email address.
<br /><br />
If <code>reject-sender</code> is given multiple times, spamdyke will use every value it finds.
<br /><br />
If <code>reject-sender</code> is not given, spamdyke will use the value <code>none</code>.
<br /><br />
See <a href="#REJECTING_SENDERS">Rejecting Senders</a> for details.
</td>

</tr><tr>
<td><code>reject-unresolvable-rdns</code></td>
<td><code>R</code></td>
<td>
<i>optional:</i><br />
<code>0</code>,
<code>1</code>,
<code>false</code>,
<code>true</code>,
<code>no</code> or
<code>yes</code>
</td>
<td>
Reject the connection if the remote server's rDNS name does not resolve (search
for an A record).
<br /><br />
If <code>reject-unresolvable-rdns</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>reject-unresolvable-rdns</code> is not given, spamdyke will not reject connections from remote
servers whose rDNS names do not resolve.
<br /><br />
If <code>reject-unresolvable-rdns</code> is given without an argument, spamdyke will use a value of <code>yes</code>.
<br /><br />
See <a href="#RDNS">Reverse DNS</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-auth-failure</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
authentication fails for any reason.
<br /><br />
If <code>rejection-text-auth-failure</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-auth-failure</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Authentication failed.</code>
<br /><br />
<code>rejection-text-auth-failure</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-auth-unknown</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server attempts to authenticate using an unsupported authentication method.
This should never happen.
<br /><br />
If <code>rejection-text-auth-unknown</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-auth-unknown</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Unknown authentication method.</code>
<br /><br />
<code>rejection-text-auth-unknown</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-dns-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's IP address is found on a DNS blacklist (RBL).
The name of the matching RBL will be appended to <code>TEXT</code>.
Note: this flag has no effect if the RBL returns a text message; that text will be used instead.
<br /><br />
If <code>rejection-text-dns-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-dns-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your IP address is listed in the DNS RBL at </code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-earlytalker</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server sends data before the SMTP greeting banner is displayed.
<br /><br />
If <code>rejection-text-earlytalker</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-earlytalker</code> is not given, spamdyke will use the text
<code class="breakable">Refused. You are not following the SMTP protocol.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-empty-rdns</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server has no rDNS name.
<br /><br />
If <code>rejection-text-empty-rdns</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-empty-rdns</code> is not given, spamdyke will use the text
<code class="breakable">Refused. You have no reverse DNS entry.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-graylist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the recipient address has been graylisted.
<br /><br />
If <code>rejection-text-graylist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-graylist</code> is not given, spamdyke will use the text
<code class="breakable">Your address has been graylisted. Try again later.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-header-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the message is blocked because a header line matches a header blacklist.
<br /><br />
If <code>rejection-text-header-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-header-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your message has been blocked due to its content.</code>
<br /><br />
If <code>rejection-text-header-blacklist</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-ip-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's IP address is found in an IP blacklist file or matches an IP blacklist entry.
<br /><br />
If <code>rejection-text-ip-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-ip-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your IP address is blacklisted.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-ip-in-cc-rdns</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's rDNS name contains the remote server's IP address and ends in a two-character country code.
<br /><br />
If <code>rejection-text-ip-in-cc-rdns</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-ip-in-cc-rdns</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your reverse DNS entry contains your IP address and a country code.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-ip-in-rdns-keyword-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's rDNS name contains the remote server's IP address and a banned keyword.
<br /><br />
If <code>rejection-text-ip-in-rdns-keyword-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-ip-in-rdns-keyword-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your reverse DNS entry contains your IP address and a banned keyword.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-local-recipient</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the specified recipient does not include a domain name.
<br /><br />
If <code>rejection-text-local-recipient</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-local-recipient</code> is not given, spamdyke will use the text
<code class="breakable">Improper recipient address. Try supplying a domain name.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-max-recipients</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server gives too many recipient addresses.
<br /><br />
If <code>rejection-text-max-recipients</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-max-recipients</code> is not given, spamdyke will use the text
<code class="breakable">Too many recipients. Try the remaining addresses again later.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-rdns-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's rDNS name is found in a blacklist file or matches a blacklist entry.
<br /><br />
If <code>rejection-text-rdns-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-rdns-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your domain name is blacklisted.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-recipient-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the recipient address is blacklisted.
<br /><br />
If <code>rejection-text-recipient-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-recipient-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Mail is not being accepted at this address.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-recipient-same-as-sender</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the sender's email addresses is the same as the recipient's email address.
<br /><br />
If <code>rejection-text-recipient-same-as-sender</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-recipient-same-as-sender</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Identical sender and recipient addresses are not allowed.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-recipient-invalid</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the recipient address is invalid and qmail would bounce the message.
<br /><br />
If <code>rejection-text-recipient-invalid</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-recipient-invalid</code> is not given, spamdyke will use the text
<code class="breakable">Refused. The recipient address does not exist.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-recipient-unavailable</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the recipient address is invalid and qmail would queue the message (until it bounced).
<br /><br />
If <code>rejection-text-recipient-unavailable</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-recipient-unavailable</code> is not given, spamdyke will use the text
<code class="breakable">Refused. The recipient is not accepting mail right now.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-reject-all</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
all mail is being rejected.
<br /><br />
If <code>rejection-text-reject-all</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-reject-all</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Mail is not being accepted.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-relaying-denied</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the recipient is not local and the remote server is not allowed relay.
<br /><br />
If <code>rejection-text-relaying-denied</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-relaying-denied</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Sending to remote addresses (relaying) is not allowed.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-rhs-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's rDNS name or the sender's domain name are found on a right-hand side blacklist (RHSBL).
The name of the matching RHSBL will be appended to <code>TEXT</code>.
Note: this flag has no effect if the RHSBL returns a text message; that text will be used instead.
<br /><br />
If <code>rejection-text-rhs-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-rhs-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your domain name is listed in the RHSBL at </code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-sender-authentication-mismatch</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the sender's email address does not match the username given during authentication.
<br /><br />
If <code>rejection-text-sender-authentication-mismatch</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-sender-authentication-mismatch</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your sender address does not match your authentication username.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-sender-blacklist</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the sender's email address is blacklisted.
<br /><br />
If <code>rejection-text-sender-blacklist</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-sender-blacklist</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your sender address has been blacklisted.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-sender-no-mx</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the sender's domain name does not have a DNS entry for a mail exchanger (MX).
<br /><br />
If <code>rejection-text-sender-no-mx</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-sender-no-mx</code> is not given, spamdyke will use the text
<code class="breakable">Refused. The domain of your sender address has no mail exchanger (MX).</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-sender-not-local</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the sender's email address is not hosted locally.
<br /><br />
If <code>rejection-text-sender-not-local</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-sender-not-local</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Mail for your sender domain is not hosted here.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-smtp-auth-required</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
authentication is required to send email and the remote server has not authenticated.
<br /><br />
If <code>rejection-text-smtp-auth-required</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-smtp-auth-required</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Authentication is required to send mail.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-timeout</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the connection times out.
<br /><br />
If <code>rejection-text-text-timeout</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-text-timeout</code> is not given, spamdyke will use the text
<code class="breakable">Timeout. Talk faster next time.</code>
<br /><br />
<code>rejection-text-timeout</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-tls-failure</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
a SSL/TLS session cannot be started with the remote server.
<br /><br />
If <code>rejection-text-text-tls-failure</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-text-tls-failure</code> is not given, spamdyke will use the text
<code class="breakable">Failed to negotiate TLS connection.</code>
<br /><br />
<code>rejection-text-tls-failure</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-unresolvable-rdns</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
the remote server's rDNS name does not resolve.
<br /><br />
If <code>rejection-text-unresolvable-rdns</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-unresolvable-rdns</code> is not given, spamdyke will use the text
<code class="breakable">Refused. Your reverse DNS entry does not resolve.</code>
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>rejection-text-zero-recipients</code></td>
<td>&nbsp;</td>
<td><code>TEXT</code></td>
<td>
Send <code>TEXT</code> to the client as an error message if
none of the recipients given by the remote server are accepted.
<br /><br />
If <code>rejection-text-zero-recipients</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>rejection-text-zero-recipients</code> is not given, spamdyke will use the text
<code class="breakable">Refused. You must specify at least one valid recipient.</code>
<br /><br />
<code>rejection-text-zero-recipients</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_ERROR">SMTP Error Codes</a> for details.
</td>

</tr><tr>
<td><code>relay-level</code></td>
<td>&nbsp;</td>
<td>
<code>block-all</code>,
<code>normal</code> or
<code>allow-all</code>
</td>
<td>
<code>block-all</code>: Block all relaying attempts, even if the sender has authenticated or the access file or an environment variable should allow relaying.
Messages to local recipients will still be accepted.
Requires <code>qmail-rcpthosts-file</code> to be set to a valid filename.
<br /><br />
<code>normal</code>: Do not prevent relaying; allow qmail (or another filter) to prevent relaying as appropriate.
<br /><br />
<code>allow-all</code>: Allow relaying from all senders.  Note: This creates an open relay and is not recommended.
<br /><br />
If <code>relay-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>relay-level</code> is not given, spamdyke will use a value of <code>normal</code>.
<br /><br />
<code>relay-level</code> is not valid within configuration directories.
<br /><br />
See <a href="#RELAYING">Relaying</a> for details.
</td>

</tr><tr>
<td><code>rhs-blacklist-entry</code></td>
<td><code>X</code></td>
<td><code>RHSBL</code></td>
<td>
Check the remote server's rDNS name and the sender email address' domain name
against the right hand-side blackhole list <code>RHSBL</code>. If it is found, the connection
is rejected.
NOTE: Using more than a few RHS blacklists can cause serious performance problems.
<br /><br />
If <code>rhs-blacklist-entry</code> is given multiple times, spamdyke will check each given <code>RHSBL</code> for the remote server's rDNS name and the sender's email address domain name.
<br /><br />
If <code>rhs-blacklist-entry</code> and <code>rhs-blacklist-file</code> are not given, spamdyke will not check any blackhole lists
for the remote server's rDNS name and the sender's email address domain name.
<br /><br />
See <a href="#DNSRHSBL">DNS RHSBLs</a> for details.
</td>

</tr><tr>
<td><code>rhs-blacklist-file</code></td>
<td>&nbsp;</code>
<td><code>FILE</code></td>
<td>
Check the remote server's domain name and the sender email address' domain name
against each of the right hand-side blackhole lists listed in <code>FILE</code>.
If it is found on any of the lists, the connection is rejected.
NOTE: Using more than a few RHS blacklists can cause serious performance problems.
<br /><br />
If <code>rhs-blacklist-file</code> is given multiple times, spamdyke will check each blackhole list listed in each given <code>FILE</code> for the remote server's
rDNS name and the sender's email address domain name.
<br /><br />
If <code>rhs-blacklist-file</code> and <code>rhs-blacklist-file</code> are not given, spamdyke will not check any blackhole lists
for the remote server's rDNS name and the sender's email address domain name.
<br /><br />
See <a href="#DNSRHSBL">DNS RHSBLs</a> for details.
</td>

</tr><tr>
<td><code>rhs-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>RHSWHITELIST</code></td>
<td>
Check the remote server's domain name and the sender email address' domain name
against the right hand-side whitelist <code>RHSWHITELIST</code> (essentially an RHSBL that
contains whitelisted domains). If it is found, all filters are bypassed.
NOTE: Using more than a few RHS whitelists can cause serious performance problems.
<br /><br />
If <code>rhs-whitelist-entry</code> is given multiple times, spamdyke will check each given <code>RHSWHITELIST</code> for the remote server's rDNS name and the sender's email address domain name.
<br /><br />
If <code>rhs-whitelist-entry</code> and <code>rhs-whitelist-file</code> are not given, spamdyke will not check any whitelists
for the remote server's rDNS name and the sender's email address domain name.
<br /><br />
See <a href="#DNSWHITELISTS">DNS Whitelists</a> for details.
</td>

</tr><tr>
<td><code>rhs-whitelist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Check the remote server's domain name and the sender email address' domain name
against each of the right hand-side whitelists (essentially an RHSBL that
contains whitelisted domains) listed in <code>FILE</code>. If it is found on any of the lists, all filters are bypassed.
NOTE: Using more than a few RHS whitelists can cause serious performance problems.
<br /><br />
If <code>rhs-whitelist-file</code> is given multiple times, spamdyke will check each whitelist listed in each given <code>FILE</code> for the remote server's
rDNS name and the sender's email address domain name.
<br /><br />
If <code>rhs-whitelist-file</code> and <code>rhs-whitelist-file</code> are not given, spamdyke will not check any whitelist
for the remote server's rDNS name and the sender's email address domain name.
<br /><br />
See <a href="#DNSWHITELISTS">DNS Whitelists</a> for details.
</td>

</tr><tr>
<td><code>run-as-user</code></td>
<td>&nbsp;</td>
<td><code>USER[:GROUP]</code></td>
<td>
As soon as possible, change the running user identity to the user with the username or ID <code>USER</code>.
If <code>GROUP</code> is provided, also change the group identity to the system
group with the name <code>GROUP</code> or ID <code>GROUP</code>.
This feature requires spamdyke to be started as a user with the ability to switch identities (typically the superuser).
<br /><br />
If <code>run-as-user</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>run-as-user</code> is not given, spamdyke will not attempt to switch user identities.
<br /><br />
<code>run-as-user</code> is not valid within configuration directories.
<br /><br />
See <a href="#PERMISSIONS">Permissions</a> for details.
</td>

</tr><tr>
<td><code>sender-blacklist-entry</code></td>
<td>&nbsp;</td>
<td><code>ADDRESS</code></td>
<td>
Reject the connection if the sender's email address matches <code>ADDRESS</code>.
<br /><br />
If <code>sender-blacklist-entry</code> is given multiple times, spamdyke will reject the connection if the sender's email address matches any of the given <code>ADDRESS</code> values.
<br /><br />
If <code>sender-blacklist-entry</code> and <code>sender-blacklist-file</code> are not given, spamdyke will not blacklist any sender email addresses.
<br /><br />
See <a href="#REJECTING_SENDERS">Rejecting Senders</a> for details.
</td>

</tr><tr>
<td><code>sender-blacklist-file</code></td>
<td><code>s</code></td>
<td><code>FILE</code></td>
<td>
Reject the connection if the sender's email address matches an entry in <code>FILE</code>.
This option provides better performance than <code>sender-blacklist-entry</code> for more than a few entries.
<br /><br />
If <code>sender-blacklist-file</code> is given multiple times, spamdyke will reject the connection if the sender's email address matches any of the entries in each given <code>FILE</code>.
<br /><br />
If <code>sender-blacklist-entry</code> and <code>sender-blacklist-file</code> are not given, spamdyke will not blacklist any sender email addresses.
<br /><br />
See <a href="#REJECTING_SENDERS">Rejecting Senders</a> for details.
</td>

</tr><tr>
<td><code>sender-whitelist-entry</code></td>
<td>&nbsp;</td>
<td><code>ADDRESS</code></td>
<td>
If the sender's email address matches <code>ADDRESS</code>, bypass all filters.
<br /><br />
If <code>sender-whitelist-entry</code> is given multiple times, spamdyke will compare the sender's email address to each given <code>ADDRESS</code>.
<br /><br />
If <code>sender-whitelist-entry</code> and <code>sender-whitelist-file</code> are not given, spamdyke will not whitelist any sender email addresses.
<br /><br />
See <a href="#WHITELISTING_ADDRESSES">Whitelisting Senders and Recipients</a> for details.
</td>

</tr><tr>
<td><code>sender-whitelist-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
If the sender's email address matches an entry in <code>FILE</code>, bypass all filters.
This option provides better performance than <code>sender-whitelist-entry</code> for more than a few entries.
<br /><br />
If <code>sender-whitelist-file</code> is given multiple times, spamdyke will compare the sender's email address to each entry in each given <code>FILE</code>.
<br /><br />
If <code>sender-whitelist-entry</code> and <code>sender-whitelist-file</code> are not given, spamdyke will not whitelist any sender email addresses.
<br /><br />
See <a href="#WHITELISTING_ADDRESSES">Whitelisting Senders and Recipients</a> for details.
</td>

</tr><tr>
<td><code>smtp-auth-command</code></td>
<td>&nbsp;</td>
<td><code>COMMAND</code></td>
<td>
Perform SMTP AUTH verification using <code>COMMAND</code>.
If the authentication is valid, all filters will be
bypassed.  This option may have no effect, depending on the value of <code>smtp-auth-level</code>.
<br /><br />
If <code>smtp-auth-command</code> is given multiple times, spamdyke will authenticate using each given <code>COMMAND</code> until one of them indicates success.
<br /><br />
If <code>smtp-auth-command</code> is not given, spamdyke will not process authentication.  Depending on the value of <code>smtp-auth-level</code>, authentication may still be possible.
<br /><br />
<code>smtp-auth-command</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_AUTH">SMTP AUTH</a> for details.
</td>

</tr><tr>
<td><code>smtp-auth-level</code></td>
<td>&nbsp;</td>
<td>
<code>none</code>,
<code>observe</code>,
<code>ondemand</code>,
<code>ondemand-encrypted</code>,
<code>always</code> or
<code>always-encrypted</code>
</td>
<td>
<code>none</code>: Do not offer or allow authentication, even if qmail has been patched to provide it.
<br /><br />
<code>observe</code>: Observe authentication only (and trust qmail's responses), do not offer it.  This value has no effect if qmail has not been patched to offer authentication.
<br /><br />
<code>ondemand</code>: If qmail offers authentication, observe any authentication attempts and trust qmail's responses.  If qmail does not offer authentication, spamdyke will
offer cleartext authentication, then process it using the value of <code>smtp-auth-command</code>.
<br /><br />
<code>ondemand-encrypted</code>: If qmail offers authentication, observe any authentication attempts and trust qmail's responses.  If qmail does not offer authentication, spamdyke will
offer cleartext and encrypted authentication, then process it using the value of <code>smtp-auth-command</code>.
<br /><br />
<code>always</code>: Always offer cleartext authentication, then process it using the value of <code>smtp-auth-command</code>.  If qmail attempts to offer authentication, spamdyke will
hide qmail's offer and prevent the authentication data from reaching qmail.
<br /><br />
<code>always-encrypted</code>: Always offer cleartext and encrypted authentication, then process it using the value of <code>smtp-auth-command</code>.
If qmail attempts to offer authentication, spamdyke will hide qmail's offer and prevent the authentication data from reaching qmail.
<br /><br />
If <code>smtp-auth-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>smtp-auth-level</code> is not given, spamdyke will use a value of <code>observe</code>.
<br /><br />
<code>smtp-auth-level</code> is not valid within configuration directories.
<br /><br />
See <a href="#SMTP_AUTH">SMTP AUTH</a> for details.
</td>

</tr><tr>
<td><code>tls-certificate-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Decrypt SSL/TLS traffic using the SSL certificate in <code>FILE</code>.  The certificate must be in PEM format.
If <code>FILE</code> does not also contain the private key, <code>tls-privatekey-file</code> must be used.
This option has no effect unless <code>tls-level</code> is also given.
<br /><br />
If <code>tls-certificate-file</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>tls-certificate-file</code> is not given, spamdyke will not decrypt SSL/TLS traffic.  The encrypted traffic will be passed through to qmail.
<br /><br />
<code>tls-certificate-file</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr><tr>
<td><code>tls-cipher-list</code></td>
<td>&nbsp;</td>
<td><code>STRING</code></td>
<td>
During SSL/TLS connections, use the list ciphers given in <code>STRING</code>.
Normally this is not needed, the default list of ciphers is adequate for most usages.
This option has no effect unless <code>tls-level</code> is also given.
<br /><br />
If <code>tls-cipher-list</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
<code>tls-cipher-list</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr><tr>
<td><code>tls-dhparams-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
During SSL/TLS connections, use the contents of <code>FILE</code> for creating ephemeral DH keys.
Normally this is not needed, since the default ciphers do not use ephemeral DH keys.
This option has no effect unless <code>tls-level</code> is also given.
<br /><br />
If <code>tls-dhparams-file</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
<code>tls-dhparams-file</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr><tr>
<td><code>tls-level</code></td>
<td>&nbsp;</td>
<td>
<code>none</code>,
<code>smtp</code>
<code>smtp-no-passthrough</code> or
<code>smtps</code>
</td>
<td>
<code>none</code>: Do not offer or allow SSL/TLS, even if qmail supports it.
<br /><br />
<code>smtp</code>: If <code>tls-certificate-file</code> is given, offer TLS during the SMTP conversation and decrypt the traffic.  If <code>tls-certificate-file</code> is not given,
allow qmail to offer TLS (if it has been patched to provide TLS) and pass the encrypted traffic to qmail.
<br /><br />
<code>smtp-no-passthrough</code>: If <code>tls-certificate-file</code> is given, offer TLS during the SMTP conversation and decrypt the traffic.
If <code>tls-certificate-file</code> is not given, prevent TLS from starting.
<br /><br />
<code>smtps</code>: Initiate a SSL session at the beginning of the connection, before SMTP begins.
<br /><br />
If <code>tls-level</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>tls-level</code> is not given, spamdyke will use a value of <code>smtp</code>.
<br /><br />
<code>tls-level</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr><tr>
<td><code>tls-privatekey-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Read the private key for the SSL certificate (given with <code>tls-certificate-file</code>) from
<code>FILE</code>. <code>FILE</code> must be in PEM format. Requires <code>tls-certificate-file</code>.
<br /><br />
If <code>tls-privatekey-file</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>tls-privatekey-file</code> is not given, spamdyke will look for the private key in the certificate file.
<br /><br />
<code>tls-privatekey-file</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr><tr>
<td><code>tls-privatekey-password</code></td>
<td>&nbsp;</td>
<td><code>PASSWORD</code></td>
<td>
Use <code>PASSWORD</code> to decrypt the SSL private key (given with <code>tls-certificate-file</code> or
<code>tls-privatekey-file</code>), if necessary. NOTE: this option reveals the password in
the process list! Requires <code>tls-certificate-file</code> and/or <code>tls-privatekey-file</code>.
<br /><br />
If <code>tls-privatekey-password</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>tls-privatekey-password</code> and <code>tls-privatekey-password-file</code> are not given, spamdyke will attempt to load the private key without a password.
<br /><br />
<code>tls-privatekey-password</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr><tr>
<td><code>tls-privatekey-password-file</code></td>
<td>&nbsp;</td>
<td><code>FILE</code></td>
<td>
Read the password to decrypt the private key for the SSL certificate (from
<code>tls-certificate-file</code>) from the first line of <code>FILE</code>, if necessary. Requires
<code>tls-certificate-file</code> and/or <code>tls-password-file</code>.
<br /><br />
If <code>tls-privatekey-password-file</code> is given multiple times, spamdyke will use the last value it finds.
<br /><br />
If <code>tls-privatekey-password</code> and <code>tls-privatekey-password-file</code> are not given, spamdyke will attempt to load the private key without a password.
<br /><br />
<code>tls-privatekey-password-file</code> is not valid within configuration directories.
<br /><br />
See <a href="#TLS">TLS</a> for details.
</td>

</tr>
</table>

<a name="CONFIGURATION_FILE"></a>
<h2>Configuration Files</h2>
<h3>
<code>config-file</code>
</h3>
<p>
The configuration file format is very simple.  Each line should use the following
format:
<dl>
<dd><code>OPTION=VALUE</code>
</dl>
<code>OPTION</code> is the long version of a spamdyke option.  See <a href="#USAGE">Usage</a> for details.
</p><p>
<code>VALUE</code> is the parameter for the option.  Note: While multi-word
values must be quoted on the command line, quotes are not allowed in configuration files.
spamdyke reads the entire <code>VALUE</code> after the equals sign,
even if it contains spaces, so no quoting is needed.
</p><p>
Blank lines and lines beginning with <code>#</code> are ignored.
</p><p>
For example:
<dl>
<dd><code>smtp-auth-command=/home/vpopmail/bin/vchkpw /bin/true</code>
<dd><code>rdns-blacklist-dir=/home/vpopmail/blacklist_rdns.d</code>
<dd><code>graylist-dir=/home/vpopmail/graylist.d</code>
<dd><code>check-dnsrbl=dul.dnsbl.sorbs.net</code>
<dd><code>check-dnsrbl=zombie.dnsbl.sorbs.net</code>
<dd><code>max-recipients=5</code>
</dl>
True/false options can be given without a <code>VALUE</code> to activate them.
<code>yes</code>, <code>true</code> and <code>1</code> are also acceptable.
The options can also be
explicitly deactivated with <code>no</code>, <code>false</code> or <code>0</code> (or the option can be simply
removed).  For example, the following lines all have the same effect:
<dl>
<dd><code>reject-empty-rdns</code>
<dd><code>reject-empty-rdns=yes</code>
<dd><code>reject-empty-rdns=true</code>
<dd><code>reject-empty-rdns=1</code>
</dl>
A configuration file is utilized by passing the command line option <code>config-file</code> to
spamdyke:
<dl>
<dd><code>spamdyke --config-file /etc/spamdyke.conf ...</code>
</dl>
The <code>config-file</code> option can also be used within configuration files to include
other configuration files if desired.  When configuration files are in use, options may
still be provided on the command line as well, in any combination.  If contradictory
options are found, the option in the configuration file will be used.  For example, if the
following command line were used:
<dl>
<dd><code>spamdyke --reject-empty-rdns --config-file /etc/spamdyke.conf ...</code>
</dl>
And <code>/etc/spamdyke.conf</code> contained the following line:
<dl>
<dd><code>reject-empty-rdns=false</code>
</dl>
spamdyke would deactivate the <code>reject-empty-rdns</code> filter because the
configuration file is read after the command line has been scanned.  This can be confusing,
so the best practice is to avoid specifying the same option in multiple places without
good reason.
</p><p>
Some options can be given multiple times and spamdyke will use all of the values it finds.
For example, if the following lines are given, spamdyke will search each of the files
for a match to the sender's email address:
<dl>
<dd><code>sender-blacklist-file=/home/vpopmail/sender_blacklist.txt</code>
<dd><code>sender-blacklist-file=/home/vpopmail/more_sender_blacklist.txt</code>
<dd><code>sender-blacklist-file=/home/vpopmail/additional_sender_blacklist.txt</code>
</dl>
However, in some situations, it may be necessary to remove one or all of the values.
Most commonly, this occurs when the values are set in a global configuration file
and are unset in a configuration directory.  To remove one specific value from a list,
the value should be specified with an exclamation point preceeding the value:
<dl>
<dd><code>OPTION=!VALUE</code>
</dl>
For example:
<dl>
<dd><code>sender-blacklist-file=!/home/vpopmail/sender_blacklist.txt</code>
</dl>
If the given value was not previously set, no action will be taken.
</p><p>
To clear all values from a list, three exclamation points should be given instead of a value:
<dl>
<dd><code>OPTION=!!!</code>
</dl>
For example, if the following line is given, the <code>sender-blacklist-file</code> option
will be cleared and spamdyke will behave as though <code>sender-blacklist-file</code> had never
appeared:
<dl>
<dd><code>sender-blacklist-file=!!!</code>
</dl>
</p><p>
Note: spamdyke processes configuration directives in the order they are read.
If an option is cleared and later set again, the option will retain the last value.
For example, if the following five lines appear in this order:
<dl>
<dd><code>sender-blacklist-file=/home/vpopmail/sender_blacklist.txt</code>
<dd><code>sender-blacklist-file=/home/vpopmail/more_sender_blacklist.txt</code>
<dd><code>sender-blacklist-file=/home/vpopmail/additional_sender_blacklist.txt</code>
<dd><code>sender-blacklist-file=!!!</code>
<dd><code>sender-blacklist-file=/home/vpopmail/last_blacklist.txt</code>
</dl>
spamdyke will set the first three values, clear them, then set the last value.  When the
sender blacklist filter runs, it will search the file <code>/home/vpopmail/last_blacklist.txt</code>.
</p><p>
<b>NOTE:</b> It may seem that scanning a configuration file instead of the
command line would impose a performance penalty each time spamdyke is started.
However, the reverse seems to be true.  Some rudimentary testing has indicated the
configuration files are actually faster.  This is likely due to
inefficiencies in GNU's getopt_long() function.
</p>

<a name="CONFIGURATION_DIR"></a>
<h2>Configuration Directories</h2>
<h3>
<code>config-dir</code><br />
<code>config-dir-search</code>
</h3>
<p>
Configuration directories allow spamdyke's behavior to be altered based on the remote server's IP address,
the remote server's rDNS name, the sender's email address, the recipient's email address or any combination
of those things.  This can be very useful when, for example, graylisting should be deactivated for a specific
sender.  Or when RBL filters should be disabled for a specific IP address.  Or perhaps when extra filters should be
enabled for only a few recipients.
</p><p>
Configuration directories could be used to allow domain administrators or even individual users to set their own options, such as
whitelisting or blacklisting IPs or senders without affecting other domains/users on the server.
Creating a web-based control panel to do this would be relatively easy.
</p><p>
Configuration directories are given with the <code>config-dir</code> option.  The option's value should be the path
to the directory that contains the subdirectories explained below.  If <code>config-dir</code> is given multiple
times, spamdyke will search each given directory structure and load all of the matching files before it continues
processing the SMTP connection.
</p><p>
In essence, a configuration directory is a special directory structure that contains configuration files.
spamdyke determines which files to load based on the names of the directories and the details of the SMTP connection.
Not all options are valid within configuration directories, but in all other respects the files follow the same
rules as global configuration files.  See <a href="#USAGE">Usage</a> for details of which options are valid
within configuration directories.  See <a href="#CONFIGURATION_FILE">Configuration Files</a> for details of the configuration file format.
</p><p>
When spamdyke loads a file from a configuration directory, it will do so because the names of the directories
and the name of the file match all or part of the information from the SMTP connection.
The last piece of information should always be used as the name of the file, not the name of a directory.
</p><p>
To create a file using the IP address of the remote server, first create a directory structure that
begins with <code>_ip_</code> and uses the first three octets of the address as directory names.  For example,
if the IP address is <code>11.22.33.44</code>, the directory structure should look like this:
<dl>
<dd><code>.../_ip_/11/22/33</code>
</dl>
Use the fourth octet as the name of the configuration file.  For example:
<dl>
<dd><code>.../_ip_/11/22/33/44</code>
</dl>
</p><p>
To create a file using the rDNS name of the remote server, first create a directory structure that begins with
<code>_rdns_</code> and contains directories named using the rDNS name with its words reversed.  For example,
if the rDNS name is <code>mail.internal.headquarters.example.com</code>, the directory structure should look like this:
<dl>
<dd><code>.../_rdns_/com/example/headquarters/internal</code>
</dl>
The last word of the rDNS name is used as the name of the configuration file.  For example:
<dl>
<dd><code>.../_rdns_/com/example/headquarters/internal/mail</code>
</dl>
</p><p>
To create a file using the sender's email address, first create a directory structure that begins with
<code>_sender_</code> and contains directories using the domain portion of the sender's email address with its words reversed
and ending in <code>_at_</code>.  For example, if the sender's email address is <code>mom@home.example.com</code>,
the directory structure should look like this:
<dl>
<dd><code>.../_sender_/com/example/home/_at_</code>
</dl>
The sender's username is used as the name of the configuration file.  For example:
<dl>
<dd><code>.../_sender_/com/example/home/_at_/mom</code>
</dl>
</p><p>
To create a file using the recipient's email address, first create a directory structure that begins with
<code>_recipient_</code> and contains directories using the domain portion of the recipient's email address with its words reversed
and ending in <code>_at_</code>.  For example, if the recipient's email address is <code>kid@school.example.com</code>,
the directory structure should look like this:
<dl>
<dd><code>.../_recipient_/com/example/school/_at_</code>
</dl>
The recipient's username is used as the name of the configuration file.  For example:
<dl>
<dd><code>.../_recipient_/com/example/school/_at_/kid</code>
</dl>
spamdyke will match partial IP addresses, rDNS names, sender email addresses or recipient email addresses left-most portions
of the directory structure are omitted.  Note: spamdyke will never read a configuration file named <code>_at_</code>.
If the sender's or recipient's username are omitted, the <code>_at_</code> directory must be omitted as well.  For example,
if the IP address is <code>11.22.33.44</code>, the rDNS name is <code>mail.internal.headquarters.example.com</code>,
the sender's email address is <code>mom@home.example.com</code> and the recipient's email address is <code>kid@school.example.com</code>,
spamdyke will look for configuration files with the following paths:
<dl>
<dd><code>.../_ip_/11/22/33/44</code>
<dd><code>.../_ip_/11/22/33</code>
<dd><code>.../_ip_/11/22</code>
<dd><code>.../_ip_/11</code>
<dd><code>.../_rdns_/com/example/headquarters/internal/mail</code>
<dd><code>.../_rdns_/com/example/headquarters/internal</code>
<dd><code>.../_rdns_/com/example/headquarters</code>
<dd><code>.../_rdns_/com/example</code>
<dd><code>.../_rdns_/com</code>
<dd><code>.../_recipient_/com/example/school/_at_/kid</code>
<dd><code>.../_recipient_/com/example/school</code>
<dd><code>.../_recipient_/com/example</code>
<dd><code>.../_recipient_/com</code>
<dd><code>.../_sender_/com/example/home/_at_/mom</code>
<dd><code>.../_sender_/com/example/home</code>
<dd><code>.../_sender_/com/example</code>
<dd><code>.../_sender_/com</code>
</dl>
</p><p>
Configuration directories can be nested to create more specific targets.  For example, if the IP address of the remote
server is <code>11.22.33.44</code> and the sender's email address is <code>mom@home.example.com</code>, spamdyke will
read a configuration file if its path is either of the following:
<dl>
<dd><code>.../_ip_/11/22/33/44/_sender_/com/example/home/_at_/mom</code>
<dd><code>.../_sender_/com/example/home/_at_/mom/_ip_/11/22/33/44</code>
</dl>
If only portions of the IP address or sender address are used, the possible list of file paths increases dramatically:
<dl>
<dd><code>.../_ip_/11/22/33/44/_sender_/com/example/home</code>
<dd><code>.../_ip_/11/22/33/44/_sender_/com/example</code>
<dd><code>.../_ip_/11/22/33/44/_sender_/com</code>
<dd><code>.../_ip_/11/22/33/_sender_/com/example/home/_at_/mom</code>
<dd><code>.../_ip_/11/22/_sender_/com/example/home/_at_/mom</code>
<dd><code>.../_ip_/11/_sender_/com/example/home/_at_/mom</code>
<dd><code>.../_sender_/com/example/home/_ip_/11/22/33</code>
<dd><code>.../_sender_/com/example/_ip_/11/22</code>
<dd><code>.../_sender_/com/_ip_/11</code>
</dl>
spamdyke will check for every possible combination of partial paths (not all permutations are listed here).
rDNS name directories and recipient directories can also be nested to create configuration files that will only
be loaded if all four pieces of information match.
</p><p>
If all of that isn't confusing enough, spamdyke will only read one file from a
<code>_ip_</code>, <code>_rdns_</code>, <code>_sender_</code> or <code>_recipient_</code>
directory, even if more
matches are possible.  For example, if the remote IP address is <code>11.22.33.44</code>, the sender's email address is
<code>mom@home.example.com</code> and the recipient's email address is <code>kid@school.example.com</code> and two
files exist with the following paths:
<dl>
<dd><code>.../_ip_/11/22/33/44/_sender_/com/example/home/_at_/mom</code>
<dd><code>.../_ip_/11/22/33/44/_recipient_/com/example/school/_at_/kid</code>
</dl>
spamdyke will only read one of the files because the <code>_ip_</code> directory cannot be matched more than once.
This behavior can be changed with the <code>config-dir-search</code> option.
</p><p>
<code>config-dir-search</code> can be given multiple times; the values will be added together to create a composite value.
The possible values are:
<ul>
<li><code>first</code>: Match each <code>_ip_</code>, <code>_rdns_</code>, <code>_sender_</code> or <code>_recipient</code>
directory only once. <b>NOTE:</b> The <code>first</code> value erases the composite value created from the other possible
values, essentially "resetting" the <code>config-dir-search</code> option.
<li><code>all-ip</code>: Match each <code>_ip_</code> directory as many times as possible.
<li><code>all-rdns</code>: Match each <code>_rdns_</code> directory as many times as possible.
<li><code>all-sender</code>: Match each <code>_sender_</code> directory as many times as possible.
<li><code>all-recipient</code>: Match each <code>_recipient_</code> directory as many times as possible.
</ul>
</p><p>
To aid with troubleshooting, spamdyke will log the paths it searches if the <code>log-level</code> option is <code>debug</code>
or higher.
</p>

<a name="CONFIGURATION_TEST"></a>
<h2>Configuration Tests</h2>
<h3>
<code>config-test</code><br />
<code>config-test-smtpauth-username</code><br />
<code>config-test-smtpauth-password</code>
</h3>
<p>
spamdyke has the ability to scan its configuration
and look for common configuration mistakes.  It checks file paths, permissions, graylist folders, directory structures,
SMTP AUTH commands, TLS certificates and more.  This feature was inspired by Apache's ability
to check its configuration file for syntax errors.
</p><p>
To use the testing feature:
<ol>
<li>Find and copy the entire spamdyke command line from your "supervise" script or xinetd configuration
file, including the qmail command(s).
<li>At a command prompt, login as root and paste the spamdyke command without running it.
<li>Add the option <code>--config-test</code>
among the spamdyke options (before the qmail command).  If appropriate, add the options
<code>--config-test-smtpauth-username</code> and <code>--config-test-smtpauth-password</code>.
<li>Run the command and carefully read the results.  More output can be obtained by
increasing the logging level (no test output goes to syslog).
</ol>
If the <code>run-as-user</code> option is not given in your spamdyke configuration, it should be
used on the command line to give spamdyke the name (or user ID) of the account used to run the mail
server.  The group name (or ID) can also be given.  Before spamdyke
runs its configuration tests, it will change process ownership to run as the given user.  That way,
the filesystem permissions tests will be accurate.
</p><p>
If spamdyke is configured to provide SMTP AUTH (using the <code>smtp-auth-level</code>
and <code>smtp-auth-command</code> options), the <code>--config-test-smtpauth-username</code>
and <code>--config-test-smtpauth-password</code> options should be used to provide a valid
username and password for authentication.  spamdyke will run the SMTP AUTH command to test
its capabilities and make recommendations.
</p><p>
<b><u>IMPORTANT! DANGER! WARNING!</u></b> DO NOT EVER PUT THE <code>--config-test</code> OPTION IN
THE SPAMDYKE COMMAND LINE THAT IS RUN FOR INCOMING CONNECTIONS!  YOUR MAIL SERVER WILL
IMMEDIATELY STOP RECEIVING MAIL AND REMOTE USERS WILL SEE ONLY THE DIAGNOSTIC OUTPUT!
If you make this mistake and ask for help, expect to be publicly mocked.
You have been warned.
</p>

<a name="LOG"></a>
<h2>Log Messages</h2>
<h3>
<code>log-level</code><br />
<code>log-target</code>
</h3>
<p>
The <code>log-target</code> option controls where spamdyke logs its
messages.  By default, <code>log-target</code> is set to <code>syslog</code>,
which sends log messages to the system syslog facility.
When <code>log-target</code> is set to <code>stderr</code>, messages are sent to standard error (stderr) instead.
For most qmail installations, this will cause spamdyke's messages to be logged
by the "multilog" program, along with qmail-smtpd's output.
If <code>log-target</code> is given multiple times with different values,
spamdyke will send its output to each given target.
</p><p>
When spamdyke logs to syslog, it uses the <code>LOG_MAIL</code>
facility, which typically puts the messages in <code>/var/log/maillog</code>.
(Note: Plesk reconfigures syslog to put the messages in <code>/usr/local/psa/var/log/maillog</code>.)
</p><p>
Regardless of how the messages are logged, errors are always
be preceded by the text <code>ERROR:</code> and are fairly self-explanatory.  Whenever
possible, spamdyke will recover from an error and continue processing mail.
Philosophically, it's better to continue receiving spam than to block all mail.
</p><p>
The <code>log-level</code> option controls how much logging takes place.  The following
values are supported:
<ul>
<li><code>none</code>: No logging at all, even if errors occur.  This is not recommended.
<li><code>error</code>: Critical errors only, including authentication failures.  This is the default when <code>log-level</code> is not given.
<li><code>info</code>: Everything from <code>error</code> plus logging of messages (sender, recipient, IP address, rDNS name and authenticated username).
This is the value used when <code>log-level</code> is given with no value.
<li><code>verbose</code>: Everything from <code>info</code> plus non-critical errors such as network errors caused by the remote host, protocol errors,
<code>config-test</code> status messages and child process error messages.  At this level, spamdyke will also
print messages to show which filter blocked the connection (if applicable) and some details about the filter's settings.
These messages will be prefixed with <code>FILTER:</code>.
<li><code>debug</code>: Everything from <code>verbose</code> plus high-level debugging messages, intended to show the processing path within spamdyke.
This level is handy for troubleshooting but it can be rather noisy.  Extra messages generated by this level will be
prefixed with <code>DEBUG():</code> and will show the file and line number within the spamdyke source code where
the message was produced.  <b>NOTE:</b> If the <code>configure</code> script is run with the <code>--without-debug-output</code>
option, spamdyke will accept the <code>debug</code> value but it will not print any more output than if <code>verbose</code> were used.
<li><code>excessive</code>: Everything from <code>debug</code> plus lots of internal status messages.  This value should only be used for development.
Extra messages generated by this level will be
prefixed with <code>EXCESSIVE():</code> and will show the file and line number within the spamdyke source code where
the message was produced.  <b>NOTE:</b> Unless the <code>configure</code> script is run with the <code>--with-excessive-output</code> option, spamdyke will not produce any more
output for <code>excessive</code> than if <code>debug</code> were used.
</ul>
Note that <code>log-level</code> must be used with care on the command line.  Specifically,
when <code>--log-level</code> is used, the value must be separated by an equals sign and no
spaces.  When <code>-l</code> is used, the value must not be separated by spaces or anything else.
For example, the following two command lines will work:
<dl>
<dd><code>/usr/local/bin/spamdyke --log-level=verbose ...</code>
<dd><code>/usr/local/bin/spamdyke -lverbose ...</code>
</dl>
The <code>log-level</code> option may also be given with no value at all, which is the same as specifiying <code>info</code>.
The following two command lines are also valid:
<dl>
<dd><code>/usr/local/bin/spamdyke --log-level ...</code>
<dd><code>/usr/local/bin/spamdyke -l ...</code>
</dl>
</p><p>
Error messages and debugging statements are always preceeded by <code>ERROR</code>, <code>DEBUG</code> or <code>EXCESSIVE</code>,
followed by the function name, the filename and the line number that produced it.  Messages showing when a filter is triggered
are preceeded by <code>FILTER</code> and do not include the location information.
Each message log entry (produced when the value of <code>log-level</code> is <code>info</code> or higher) takes the following form:
<dl>
<dd><code>CODE from: SENDER to: RECIPIENT origin_ip: IPADDRESS origin_rdns: RDNSNAME auth: USERNAME encryption: TYPE reason: REASON</code>
</dl>
This format makes the logs very easy to parse from other scripts for monitoring
and graphing.
</p><p>
The possible values of <code>CODE</code> are listed below:
<table border=1 cellspacing=0 width=100% class="options">
<tr>
<td><code>CODE</code></td>
<td>Description</td>
<td>Related Option(s)</td>
</tr>

<tr>
<td><code>ALLOWED</code></td>
<td>The message passed all filters.  qmail may still bounce the message later for other reasons beyond spamdyke's control, however.<br/>
<br/>
<code>REASON</code> will contain the text of qmail's response.
</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>ALLOWED_AUTHENTICATED</code></td>
<td>The remote client successfully authenticated using SMTP AUTH with spamdyke.  If qmail is patched to provide SMTP AUTH, this code will never be used.
This message is only printed in full log files (see <a href="#FULL_LOGGING">Logging All Data</a>); the normal log will only contain <code>ALLOWED</code>.
</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>ALLOWED_TLS</code></td>
<td>The remote client successfully started a TLS session with spamdyke.
This message is only printed in full log files (see <a href="#FULL_LOGGING">Logging All Data</a>); the normal log will only contain <code>ALLOWED</code>.
</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>DENIED_AUTH_REQUIRED</code></td>
<td>The message was blocked because the remote server has not authenticated, which is required.</td>
<td>
<code>filter-level</code>
</td>
</tr>

<tr>
<td><code>DENIED_BLACKLIST_IP</code></td>
<td>The connection was blocked because the remote server's IP
address is blacklisted.<br/>
<br/>
<code>REASON</code> will contain the matching entry if <code>ip-blacklist-entry</code> was used or the filename and matching line
number if <code>ip-blacklist-file</code> was used.
</td>
<td>
<code>ip-blacklist-entry</code><br />
<code>ip-blacklist-file</code>
</td>
</tr>

<tr>
<td><code>DENIED_BLACKLIST_NAME</code></td>
<td>The connection was blocked because
the remote server's rDNS name is blacklisted.<br/>
<br/>
<code>REASON</code> will contain:
<ul>
<li>the matching entry if <code>rdns-blacklist-entry</code> was used,
<li>the filename and matchine line number if <code>rdns-blacklist-file</code> was used, or
<li>the full path to the matching file if <code>rdns-blacklist-dir</code> was used.
</ul>
</td>
<td>
<code>rdns-blacklist-entry</code><br/>
<code>rdns-blacklist-file</code><br/>
<code>rdns-blacklist-dir</code>
</td>
</tr>

<tr>
<td><code>DENIED_EARLYTALKER</code></td>
<td>The connection was blocked because the remote server began
    sending data before the SMTP greeting was issued.</td>
<td>
<code>greeting-delay-secs</code>
</td>
</tr>

<tr>
<td><code>DENIED_GRAYLISTED</code></td>
<td>The recipient was blocked because the sender/recipient
    combination was graylisted.  The SMTP connection continues after
    this error occurs.</td>
<td>
<code>graylist-level</code>
</td>
</tr>

<tr>
<td><code>DENIED_HEADER_BLACKLISTED</code></td>
<td>The message was blocked because one or more header lines matched
a header blacklist.<br/>
<br/>
<code>REASON</code> will contain the matching entry if <code>header-blacklist-entry</code> was used or the filename and matching line
number if <code>header-blacklist-file</code> was used.
</td>
<td>
<code>header-blacklist-entry</code><br />
<code>header-blacklist-file</code>
</td>
</tr>

<tr>
<td><code>DENIED_IDENTICAL_SENDER_RECIPIENT</code></td>
<td>The connection was blocked because the sender's email address is the same as
the recipient's email address.</td>
<td>
<code>reject-recipient</code>
</td>
</tr>

<tr>
<td><code>DENIED_INVALID_RECIPIENT</code></td>
<td>The recipient was rejected because the address does not exist.
The SMTP connection continues after this error occurs.</td>
<td>
<code>reject-recipient</code>
</td>
</tr>

<tr>
<td><code>DENIED_IP_IN_CC_RDNS</code></td>
<td>The connection was blocked because the remote server's
    IP address was found in the remote server's rDNS name <u>and</u> the remote
    server's rDNS name ends in a country code.</td>
<td>
<code>reject-ip-in-cc-rdns</code>
</td>
</tr>

<tr>
<td><code>DENIED_IP_IN_RDNS</code></td>
<td>The connection was blocked because the remote server's
    IP address was found in the remote server's rDNS name <u>and</u> a prohibited
    keyword was found in the remote server's rDNS name.<br/>
<br/>
<code>REASON</code> will contain the matching entry if <code>ip-in-rdns-keyword-blacklist-entry</code> was used or
the filename and matching line if <code>ip-in-rdns-keyword-blacklist-file</code> was used.
</td>
<td>
<code>ip-in-rdns-keyword-blacklist-entry</code><br />
<code>ip-in-rdns-keyword-blacklist-file</code>
</td>
</tr>

<tr>
<td><code>DENIED_OTHER</code></td>
<td>The connection was rejected by qmail (or another downstream filter),
not spamdyke.<br/>
<br/>
<code>REASON</code> will contain the rejection message given by qmail (or other downstream filter).
</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>DENIED_RBL_MATCH</code></td>
<td>The connection was blocked because the remote server's IP
address was found on a DNS RBL.<br/>
<br/>
<code>REASON</code> will contain the name of the matched RBL and the text it returned (if any).
</td>
<td>
<code>dns-blacklist-entry</code><br/>
<code>dns-blacklist-file</code><br/>
</td>
</tr>

<tr>
<td><code>DENIED_RDNS_MISSING</code></td>
<td>The connection was blocked because the remote server has
    no rDNS name at all.</td>
<td>
<code>reject-empty-rdns</code>
</td>
</tr>

<tr>
<td><code>DENIED_RDNS_RESOLVE</code></td>
<td>The connection was blocked because the remote server's
    rDNS name does not resolve.
<td>
<code>reject-unresolvable-rdns</code>
</td>
</tr>

<tr>
<td><code>DENIED_RHSBL_MATCH</code></td>
<td>The connection was blocked because the remote server's reverse
DNS name was found on a right hand-side DNS blacklist (RHSBL) <b>OR</b>
because the sender's domain name was found on a right hand-side DNS blacklist
(RHSBL).<br/>
<br/>
<code>REASON</code> will contain the name of the matched RBL and the text it returned (if any).
</td>
<td>
<code>rhs-blacklist-entry</code><br/>
<code>rhs-blacklist-file</code><br/>
</td>
</tr>

<tr>
<td><code>DENIED_RECIPIENT_BLACKLISTED</code></td>
<td>The recipient was blocked because the recipient
email address is blacklisted.<br/>
<br/>
<code>REASON</code> will contain the matching entry if <code>recipient-blacklist-entry</code> was used or
the filename and matching line if <code>recipient-blacklist-file</code> was used.
</td>
<td>
<code>recipient-blacklist-entry</code><br />
<code>recipient-blacklist-file</code>
</td>
</tr>

<tr>
<td><code>DENIED_REJECT_ALL</code></td>
<td>The message was blocked because all mail is being rejected.</td>
<td>
<code>filter-level</code>
</td>
</tr>

<tr>
<td><code>DENIED_RELAYING</code></td>
<td>The recipient was blocked because the recipient's domain
    is not locally hosted and the remote server is not allowed to relay.</td>
<td>
<code>relay-level</code>
</td>
</tr>

<tr>
<td><code>DENIED_SENDER_BLACKLISTED</code></td>
<td>The connection was blocked because the sender's
    email address is blacklisted.<br/>
<br/>
<code>REASON</code> will contain the matching entry if <code>sender-blacklist-entry</code> was used or
the filename and matching line if <code>sender-blacklist-file</code> was used.
</td>
<td>
<code>sender-blacklist-entry</code><br />
<code>sender-blacklist-file</code>
</td>
</tr>

<tr>
<td><code>DENIED_SENDER_NO_MX</code></td>
<td>The connection was blocked because the sender's domain
    has no mail exchanger, making the sender address invalid.</td>
<td>
<code>reject-sender</code>
</td>
</tr>

<tr>
<td><code>DENIED_SENDER_NOT_AUTH</code></td>
<td>The connection was blocked because the sender's address does not match the username used for authentication.</td>
<td>
<code>reject-sender</code>
</td>
</tr>

<tr>
<td><code>DENIED_SENDER_NOT_LOCAL</code></td>
<td>The connection was blocked because the sender's domain
    is not hosted on the local server.</td>
<td>
<code>reject-sender</code>
</td>
</tr>

<tr>
<td><code>DENIED_TOO_MANY_RECIPIENTS</code></td>
<td>The recipient was blocked because the limit
    was reached for this connection.  The SMTP connection continues after
    this error occurs.</td>
<td>
<code>max-recipients</code>
</td>
</tr>

<tr>
<td><code>DENIED_UNQUALIFIED_RECIPIENT</code></td>
<td>The recipient was blocked because the recipient address
    had no domain name.  The SMTP connection continues after this error occurs.</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>DENIED_UNAVAILABLE_RECIPIENT</code></td>
<td>The recipient was blocked because the recipient address is not receiving email at this time.
    The SMTP connection continues after this error occurs.</td>
<td><code>reject-recipient</code></td>
</tr>

<tr>
<td><code>DENIED_ZERO_RECIPIENTS</code></td>
<td>The message was blocked because no valid recipients have been specified.</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>FAILED_AUTH</code></td>
<td>The remote server attempted to authenticate but the given
    username and/or password were incorrect.</td>
<td>
<code>smtp-auth-level</code>
</td>
</tr>

<tr>
<td><code>FAILED_TLS</code></td>
<td>The remote client attempted to start a TLS session but SSL
    negotiation failed.</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>TIMEOUT</code></td>
<td>The connection timed out, either in total time or idle time.
    If the connection was already being blocked for another reason, the code for that
    error is given as <code>REASON</code>.</td>
<td>
<code>connection-timeout-secs</code><br/>
<code>idle-timeout-secs</code>
</td>
</tr>

<tr>
<tr>
<td><code>TLS_ENCRYPTED</code></td>
<td>The remote server has started a TLS session with qmail.  spamdyke does
not have access to the server's certificate file, so it cannot decrypt the traffic
to log any information about senders or recipients.</td>
<td>
<code>tls-level</code>
</td>
</tr>

<tr>
<td><code>UNKNOWN_AUTH</code></td>
<td>The remote server requested an authentication method spamdyke
    doesn't support.  This shouldn't happen.</td>
<td>&nbsp;</td>
</tr>

</table>
</p><p>
<code>SENDER</code> is the sender email address, if known, or <code>(unknown)</code> otherwise.
NOTE: According to RFC 821, it is legal to deliver messages with no sender
address.  Most bounce messages are delivered this way.
</p><p>
<code>RECIPIENT</code> is the recipient email address, if known, or <code>(unknown)</code> otherwise.
If <code>CODE</code> is <code>ALLOWED</code>, the recipient email address will be known.
</p><p>
<code>IPADDRESS</code> is the IP address of the remote server.  This value is always known.
</p><p>
<code>RDNSNAME</code> is the rDNS name of the remote server, if known, or <code>(unknown)</code>
otherwise.
</p><p>
<code>USERNAME</code> is the username given during authentication, if authentication was
successful, or <code>(unknown)</code> otherwise.
</p><p>
<code>TYPE</code> is the type of encryption used during the connection.  The possible values are listed below:
<table border=1 cellspacing=0 width=100% class="options">
<tr>
<td><code>TYPE</code></td>
<td>Description</td>
</tr>

<tr>
<td><code>(none)</code></td>
<td>The connection is not encrypted.</td>
</tr>

<tr>
<td><code>TLS_PASSTHROUGH</code></td>
<td>The client started a TLS connection with qmail, not with spamdyke.  spamdyke is passing the encrypted
traffic between the server and client, but cannot decrypt the data.  As a result, some filters will not
be able to run.</td>
</tr>

<tr>
<td><code>TLS</code></td>
<td>The connection has been encrypted since the client started a TLS connection with spamdyke.  All filters
can run normally.</td>
</tr>

<tr>
<td><code>SSL</code></td>
<td>The connection has been encrypted since the very beginning because the client connected using SSL (SMTPS).
All filters can run normally.</td>
</tr>

</table>
</p><p>
<code>REASON</code> is provided to give an explanation of why a connection was blocked.
See the table above for the possible values.
</p>

<a name="SMTP_ERROR"></a>
<h2>SMTP Error Codes</h2>
<h3>
<code>policy-url</code><br />
<code>rejection-text-auth-failure</code><br />
<code>rejection-text-auth-unknown</code><br />
<code>rejection-text-dns-blacklist</code><br />
<code>rejection-text-earlytalker</code><br />
<code>rejection-text-empty-rdns</code><br />
<code>rejection-text-graylist</code><br />
<code>rejection-text-header-blacklist</code><br />
<code>rejection-text-ip-blacklist</code><br />
<code>rejection-text-ip-in-cc-rdns</code><br />
<code>rejection-text-ip-in-rdns-keyword-blacklist</code><br />
<code>rejection-text-local-recipient</code><br />
<code>rejection-text-max-recipients</code><br />
<code>rejection-text-missing-sender-mx</code><br />
<code>rejection-text-rdns-blacklist</code><br />
<code>rejection-text-recipient-blacklist</code><br />
<code>rejection-text-recipient-invalid</code><br />
<code>rejection-text-recipient-same-as-sender</code><br />
<code>rejection-text-recipient-unavailable</code><br />
<code>rejection-text-reject-all</code><br />
<code>rejection-text-relaying-denied</code><br />
<code>rejection-text-rhs-blacklist</code><br />
<code>rejection-text-sender-authentication-mismatch</code><br />
<code>rejection-text-sender-blacklist</code><br />
<code>rejection-text-sender-not-local</code><br />
<code>rejection-text-smtp-auth-required</code><br />
<code>rejection-text-timeout</code><br />
<code>rejection-text-tls-failure</code><br />
<code>rejection-text-unresolvable-rdns</code><br />
<code>rejection-text-zero-recipients</code><br />
</h3>
<p>
When spamdyke blocks a connection and returns an error code to a remote server,
the text it sends is different from what appears in the logs (above).
It is more user-friendly, just in case a human ever reads it (some, but not all,
mail servers display the rejection message in bounce messages).
</p><p>
The messages can be changed using the options that are listed in the third column of
the table below.
</p><p>
The messages that correspond to the syslog codes are:
<table border=1 cellspacing=0 width=100% class="options">
<tr>
<td>syslog code</td>
<td>SMTP message</td>
<td>Option to change message</td>
</tr>

<tr>
<td><code>DENIED_AUTH_REQUIRED</code></td>
<td>
<code>Refused. Authentication is required to send mail.</code>
</td>
<td><code>rejection-text-smtp-auth-required</code></td>
</tr>

<tr>
<td><code>DENIED_BLACKLIST_IP</code></td>
<td>
<code>Refused. Your IP address is blacklisted.</code>
</td>
<td><code>rejection-text-ip-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_BLACKLIST_NAME</code></td>
<td>
<code>Refused. Your domain name is blacklisted.</code>
</td>
<td><code>rejection-text-rdns-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_EARLYTALKER</code></td>
<td>
<code>Refused. You are not following the SMTP protocol.</code>
</td>
<td><code>rejection-text-earlytalker</code></td>
</tr>

<tr>
<td><code>DENIED_GRAYLISTED</code></td>
<td>
<code>Your address has been graylisted. Try again later.</code>
</td>
<td><code>rejection-text-graylist</code></td>
</tr>

<tr>
<td><code>DENIED_HEADER_BLACKLISTED</code></td>
<td>
<code>Refused. Your message has been blocked due to its content.</code>
</td>
<td><code>rejection-text-header-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_IDENTICAL_SENDER_RECIPIENT</code></td>
<td>
<code>Refused. Identical sender and recipient addresses are not allowed.</code>
</td>
<td><code>rejection-text-recipient-same-as-sender</code></td>
</tr>

<tr>
<td><code>DENIED_INVALID_RECIPIENT</code></td>
<td>
<code>Refused. The recipient address does not exist.</code>
</td>
<td><code>rejection-text-recipient-invalid</code></td>
</tr>

<tr>
<td><code>DENIED_IP_IN_CC_RDNS</code></td>
<td>
<code>Refused. Your reverse DNS entry contains your IP address and a country code.</code>
</td>
<td><code>rejection-text-ip-in-cc-rdns</code></td>
</tr>

<tr>
<td><code>DENIED_IP_IN_RDNS</code></td>
<td>
<code>Refused. Your reverse DNS entry contains your IP address and a banned keyword.</code>
</td>
<td><code>rejection-text-ip-in-rdns-keyword-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_OTHER</code></td>
<td>The text returned by qmail (or the downstream filter that generated the rejection).</td>
<td>&nbsp;</td>
</tr>

<tr>
<td><code>DENIED_RBL_MATCH</code></td>
<td>
The text returned by the DNS RBL (if any) or<br/>
<code>Refused. Your IP address is listed in the RBL at </code><i>name</i><code>.</code>
</td>
<td><code>rejection-text-dns-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_RDNS_MISSING</code></td>
<td>
<code>Refused. You have no reverse DNS entry.</code>
</td>
<td><code>rejection-text-empty-rdns</code></td>
</tr>

<tr>
<td><code>DENIED_RDNS_RESOLVE</code></td>
<td>
<code>Refused. Your reverse DNS entry does not resolve.</code>
</td>
<td><code>rejection-text-unresolvable-rdns</code></td>
</tr>

<tr>
<td><code>DENIED_RHSBL_MATCH</code></td>
<td>
The text returned by the RHSBL (if any) or<br/>
<code>Refused. Your domain name is listed in the RHSBL at </code><i>name</i><code>.</code>
</td>
<td><code>rejection-text-rhs-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_RECIPIENT_BLACKLISTED</code></td>
<td>
<code>Refused. Mail is not being accepted at this address.</code>
</td>
<td><code>rejection-text-recipient-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_REJECT_ALL</code></td>
<td>
<code>Refused. Mail is not being accepted.</code>
</td>
<td><code>rejection-text-reject-all</code></td>
</tr>

<tr>
<td><code>DENIED_RELAYING</code></td>
<td>
<code>Refused. Sending to remote addresses (relaying) is not allowed.</code>
</td>
<td><code>rejection-text-relaying-denied</code></td>
</tr>

<tr>
<td><code>DENIED_SENDER_NOT_AUTH</code></td>
<td>
<code>Refused. Your sender address does not match your authentication username.</code>
</td>
<td><code>rejection-text-sender-authentication-mismatch</code></td>
</tr>

<tr>
<td><code>DENIED_SENDER_BLACKLISTED</code></td>
<td>
<code>Refused. Your sender address has been blacklisted.</code>
</td>
<td><code>rejection-text-sender-blacklist</code></td>
</tr>

<tr>
<td><code>DENIED_SENDER_NOT_LOCAL</code></td>
<td>
<code>Refused. Mail for your sender domain is not hosted here.</code>
</td>
<td><code>rejection-text-sender-not-local</code></td>
</tr>

<tr>
<td><code>DENIED_SENDER_NO_MX</code></td>
<td>
<code>Refused. The domain of your sender address has no mail exchanger (MX).</code>
</td>
<td><code>rejection-text-missing-sender-mx</code></td>
</tr>

<tr>
<td><code>DENIED_TOO_MANY_RECIPIENTS</code></td>
<td>
<code>Too many recipients. Try the remaining addresses again later.</code>
</td>
<td><code>rejection-text-max-recipients</code></td>
</tr>

<tr>
<td><code>DENIED_UNAVAILABLE_RECIPIENT</code></td>
<td>
<code>Refused. The recipient is not accepting mail right now.</code>
</td>
<td><code>rejection-text-recipient-unavailable</code></td>
</tr>

<tr>
<td><code>DENIED_UNQUALIFIED_RECIPIENT</code></td>
<td>
<code>Improper recipient address. Try supplying a domain name.</code>
</td>
<td><code>rejection-text-local-recipient</code></td>
</tr>

<tr>
<td><code>DENIED_ZERO_RECIPIENTS</code></td>
<td>
<code>Refused. You must specify at least one valid recipient.</code>
</td>
<td><code>rejection-text-zero-recipients</code></td>
</tr>

<tr>
<td><code>FAILURE_AUTH</code></td>
<td>
<code>Refused. Authentication failed.</code>
</td>
<td><code>rejection-text-auth-failure</code></td>
</tr>

<tr>
<td><code>FAILURE_TLS</code></td>
<td>
<code>Failed to negotiate TLS connection.</code>
</td>
<td><code>rejection-text-tls-failure</code></td>
</tr>

<tr>
<td><code>TIMEOUT</code></td>
<td>
<code>Timeout. Talk faster next time.</code>
</td>
<td><code>rejection-text-timeout</code></td>
</tr>

<tr>
<td><code>UNKNOWN_AUTH</code></td>
<td>
<code>Refused. Unknown authentication method.</code>
</td>
<td><code>rejection-text-auth-unknown</code></td>
</tr>

</table>
</p><p>
If a policy location URL is given with the <code>policy-url</code> option, it
will be appended to the end of the message, just in case a human ever reads it.
This option should always be used.  When a legitimate remote user is incorrectly
blocked, the URL should provide your contact information so the error can be
corrected.
</p><p>
spamdyke will always append the syslog code to the policy URL so a web browser
will jump to an anchor within the HTML document.  Most of the time, the code is
prefixed with a <code>#</code> character.  For example, if the policy URL is:
<dl>
<dd><code>http://www.example.com/policy.html</code>
</dl>
spamdyke would generate the following URL for a rejection due to a missing reverse DNS entry:
<dl>
<dd><code>http://www.example.com/policy.html#DENIED_RDNS_MISSING</code>
</dl>
However, if the policy URL ends in an equals sign (<code>=</code>), spamdyke
will assume the URL is for a dynamic page and will not add the <code>#</code> 
character.  For example, if the policy URL is:
<dl>
<dd><code>http://www.example.com/policy?code=</code>
</dl>
spamdyke would generate the following URL for a rejection due to a missing reverse DNS entry:
<dl>
<dd><code>http://www.example.com/policy?code=DENIED_RDNS_MISSING</code>
</dl>
</p>

<a name="FULL_LOGGING"></a>
<h2>Logging All Data</h2>
<h3>
<code>full-log-dir</code>
</h3>
<p>
spamdyke has the ability to log all SMTP data to files.  This is very helpful
when debugging but (depending on the mail server traffic levels) it can generate
a huge number of files.
</p><p>
This feature is activated with the <code>full-log-dir</code> option.  Each
connection will be logged to a different file in the folder given, with a
naming convention that incorporates the current date and time, the process ID of
the spamdyke process and a random number:
<dl>
<dd><code>YYYYMMDD_HHMMSS_PID_RANDOMNUM</code>
</dl>
</p><p>
The data from the remote server and qmail are both logged to the file.  Each
transmission is preceded with a line showing its origin and destination as well
as the time and date.
</p><p>
If the remote client establishes a TLS session with qmail and spamdyke passes
the encrypted data, the logs will contain the data as hexadecimal bytes.
</p><p>
The logs will contain all debugging output spamdyke can produce, the same output
that would be produced if <code>log-level</code> were set to its highest level.
spamdyke will also print its current configuration into the log file every time it
processes a configuration file, to show what options are active and what their
values are.
</p><p>
Log files are created with a <code>0600</code> mode to protect them from being read by
unauthorized users.  Please take other precautions to protect them and don't
leave them lying around.
</p><p>
<b>NOTE:</b> This feature is intended to be used for debugging delivery problems, <b>not</b>
for monitoring email content.  Among other issues, the format of the log files does not make
it easy to reconstruct a whole message.
If you must monitor
your users' email data, please use a packet sniffer on a separate machine or
SMTP proxy software designed for the task.
</p>

<a name="PERMISSIONS"></a>
<h2>Permissions</h2>
<h3>
<code>run-as-user</code>
</h3>
<p>
On most Unix-based systems, only the superuser can start a daemon that listens on port 25 (the SMTP port).
However, since running daemons as the superuser should be avoided whenever possible, most
qmail installations use utilities to switch the daemon's owner to a normal user before
qmail actually runs.
</p><p>
Some older qmail installations lack this ability, notably ones that use the <code>inetd</code>
"superserver" to start qmail.  To help provide security in these situations, spamdyke
provides the <code>run-as-user</code> option to force spamdyke to switch to a different
user account as soon as it starts.  All of spamdyke's child processes (including qmail)
will run under the new user account.
</p><p>
The value of <code>run-as-user</code> takes the following form:
<dl>
<dd><code>USER[:GROUP]</code>
</dl>
<code>USER</code> should be the name or user ID of a valid system user.  If <code>GROUP</code>
is not provided, spamdyke will join <code>USER</code>'s default group.  If <code>GROUP</code>
is provided, it can be the name or group ID of a valid system group.
</p><p>
On systems where qmail does not run as the superuser, <code>run-as-user</code> can be used
to force spamdyke to change accounts when the <code>config-test</code> option is used, so that
its tests of filesystem permissions will be meaningful.
</p>

<a name="DNS_QUERIES"></a>
<h2>DNS Queries</h2>
<h3>
<code>dns-level</code><br />
<code>dns-max-retries-primary</code><br />
<code>dns-max-retries-total</code><br />
<code>dns-query-type-a</code><br/>
<code>dns-query-type-mx</code><br/>
<code>dns-query-type-ptr</code><br/>
<code>dns-query-type-rbl</code><br/>
<code>dns-resolv-conf</code><br />
<code>dns-server-ip</code><br />
<code>dns-server-ip-primary</code><br />
<code>dns-spoof</code><br/>
<code>dns-tcp</code><br/>
<code>dns-timeout-secs</code><br />
</h3>
<p>
Because so many of spamdyke's filters rely so heavily on DNS queries, spamdyke provides
a number of options to tune its DNS activities.  
<b>Take care when using any of these options, as setting them incorrectly can prevent spamdyke
from functioning correctly.</b>  Most of the time, there is no need to use them -- spamdyke will
read its DNS information from <code>/etc/resolv.conf</code> and the environment, as documented
in the system <code>resolver(5)</code> manual page.  If the option <code>dns-resolv-conf</code>
is given, spamdyke will read the given file instead of <code>/etc/resolv.conf</code>.
<b>NOTE:</b> spamdyke does not read the <code>/etc/hosts</code> file.
</p><p>
spamdyke ranks nameservers into two categories: "primary" and "secondary".
Primary nameservers are queried first; secondary nameservers are only queried if no
response is received from a primary nameserver.
</p><p>
Normally, spamdyke reads its list of nameservers from <code>/etc/resolv.conf</code>
(or another file given with <code>dns-resolv-conf</code>), just like
any other program.  It considers the first nameserver it finds in that file to be a primary
nameserver.  All others are considered to be secondary nameservers.  This list can be overridden,
however, using the <code>dns-server-ip</code> and <code>dns-server-ip-primary</code> options.
spamdyke also honors the <code>port</code>, <code>timeout</code> and <code>options</code>
directives (if any) in the <code>/etc/resolv.conf</code> file
(or another file given with <code>dns-resolv-conf</code>).
If the environment variable
<code>RES_OPTIONS</code> is present, spamdyke will parse it for a timeout value.
</p><p>
If either <code>dns-server-ip</code> or <code>dns-server-ip-primary</code> are used, the file
<code>/etc/resolv.conf</code> is not loaded.  Both options take values in the same format:
<dl>
<dd><code>IPADDRESS[:PORT]</code>
</dl>
The IP address must be given in dotted-quad format (e.g. <code>11.22.33.44</code>).  The port
number, if it is provided, must be an integer between <code>1</code> and <code>65535</code>,
inclusive.  If the port number is not given, the value <code>53</code> is used.
</p><p>
<code>dns-server-ip</code> and <code>dns-server-ip-primary</code> can each be given multiple
times to specify multiple servers in each category.
</p><p>
If <code>dns-server-ip</code> and <code>dns-server-ip-primary</code> are not given and no
nameservers can be found by reading <code>/etc/resolv.conf</code>, the IP address <code>127.0.0.1</code>
(the localhost address) is used.
</p><p>
By default, spamdyke will attempt to query its primary nameserver once, then all of its nameservers
twice more, taking no more than 30 seconds total.
The option <code>dns-max-retries-total</code> controls the total number of attempts spamdyke makes to
contact its nameservers (the number of query packets actually sent may be much greater than this value;
see below).  The option <code>dns-max-retries-primary</code> controls how long spamdyke sends queries
only to its primary nameservers.  This value must be less than or equal to <code>dns-max-retries-total</code>.
</p><p>
The option <code>dns-timeout-secs</code> controls the total time spamdyke will spend waiting for the
results of a single query.  All of its retries will be carried out within this time limit.  <b>NOTE: The timeout
value must be large enough for nameservers to complete their work and respond.  If it is too low, spamdyke
will never successfully complete a query.</b>
</p><p>
The <code>dns-level</code> option controls how aggressively spamdyke queries its nameservers.  It takes
the following values:
<ul>
<li><code>aggressive</code>: Query all primary nameservers simultaneously until <code>dns-max-retries-primary</code>
is reached, then query all nameservers simultaneously until <code>dns-max-retries-total</code> is reached.
This is the default.
For example, if there are 2 primary nameservers, 3 secondary nameservers, <code>dns-max-retries-primary</code> is 4
and <code>dns-max-retries-total</code> is 6, spamdyke will: send a simultaneous query to each of the 2 primary nameservers 4 times,
for a total of 8 queries.  It will then send a simultaneous query to all 5 nameservers 2 more times, for a grand total
of 18 queries.
<li><code>normal</code>: Imitate the standard system resolver's behavior by sending queries to one nameserver
at a time.  spamdyke will send queries to each of the primary nameservers in sequence until <code>dns-max-retries-primary</code>
is reached, then it will add the secondary nameservers to the sequence and continue sending queries
until <code>dns-max-retries-total</code> is reached.  Depending on the number of nameservers and the values
of <code>dns-max-retries-primary</code> and <code>dns-max-retries-total</code>, some nameservers may never be
queried.
<li><code>none</code>: Do not query any nameservers at all.  All DNS-based features will behave as though their
queries returned no results.
</ul>
</p><p>
Depending on the type of query spamdyke is performing, multiple packets are typically sent to each nameserver.
By default, when querying a DNS RBL, a "query" consists of 3 packets -- one requesting A records, one requesting TXT
records and one requesting CNAME records.  In the <code>aggressive</code> example above, the 18 queries would result in
52 data packets.  This behavior can be controlled through the use of several options:
<dl>
<dt><code>dns-query-type-a</code>: Sets the types of queries that are performed when seeking an IP address when
looking up a reverse DNS name.
The following values can be given:</dt>
<dd>
<ul>
<li><code>a</code>: Request and process DNS A records in response to queries.
<li><code>cname</code>: Request and process DNS CNAME records in response to queries.  This is desirable if the target
name is simply an alias for another name.
</ul>
</dd>
<dt><code>dns-query-type-mx</code>: Sets the types of queries that are performed when seeking a mail server record
within the "reject-missing-sender-mx" filter.
The following values can be given:</dt>
<dd>
<ul>
<li><code>a</code>: Request and process DNS A records in response to queries.  This is desirable if the name is a specific
machine instead of a domain name.
<li><code>cname</code>: Request and process DNS CNAME records in response to queries.  This is desirable if the target
name is simply an alias for another name.
<li><code>mx</code>: Request and process DNS MX records in response to queries.
</ul>
</dd>
<dt><code>dns-query-type-ptr</code>: Sets the types of queries that are performed when seeking a reverse DNS name.
The following values can be given:</dt>
<dd>
<ul>
<li><code>cname</code>: Request and process DNS CNAME records in response to queries.  This is desirable if the target
name is simply an alias for another name.  Many ISPs delegate PTR control this way.
<li><code>ptr</code>: Request and process DNS PTR records in response to queries.
</ul>
</dd>
<dt><code>dns-query-type-rbl</code>: Sets the types of queries that are performed when querying a DNS RBL, RHSBL, DNS whitelist or RHSWL.
The following values can be given:</dt>
<dd>
<ul>
<li><code>a</code>: Request and process DNS A records in response to queries.
<li><code>cname</code>: Request and process DNS CNAME records in response to queries.
<li><code>txt</code>: Request and process DNS TXT records in response to queries.
</ul>
</dd>
</dl>
<b>NOTE: It is not normally necessary to set these options; they are only useful in very specific situations where a local
DNS server does not respond quickly to a specific type of query.</b>
</p><p>
Most DNS queries are performed using UDP packets, which can carry no more than 512 bytes of data.
This is enough data for typical DNS data, but occasionally some records are too big to fit in 512 bytes.  When that
happens, the nameserver should reply with a UDP packet that indicates the data is too large.  The solution is to then
resend the query via TCP, which can handle data of any size.
spamdyke will fall back to TCP if the <code>dns-tcp</code> option is set to <code>normal</code>.  If it is <code>none</code>,
spamdyke will not use TCP at all; it will ignore the response entirely and continue its normal query pattern.
</p><p>
UDP packets are stateless, which means any server on the internet can send a UDP packet to any other server at any time.
In theory, if spamdyke sends a DNS query via UDP and a malicious server sends a UDP response at the right moment, spamdyke
will accept it as the answer to its query.  (This would be extremely difficult, as the malicious server would have
to know a lot about spamdyke's internal state to create an acceptable reply, but it is possible).
</p><p>
To prevent this from happening, spamdyke always checks the response ID against the query IDs and dicards any responses
that don't match.  In addition, spamdyke can check the IP address and port number of the remote server to see if they
match the IP and port to which the query packet(s) were sent.  The following values of the <code>dns-spoof</code> option
control spamdyke's behavior:
<ul>
<li><code>accept-all</code>: Accept any response from any server.  This is the default.
<li><code>accept-same-ip</code>: Accept any response as long as the IP address of the sending server is the same as the IP address
the query was sent to.  The port number may be different.
<li><code>accept-same-port</code>: Accept any response as long as the port number on the sending server is the same as the port number
the query was sent to.  The IP address may be different.  (This option may not be very useful.)
<li><code>reject</code>: Only accept responses where the IP address and port number of the sending server match the IP address and
port number the query was sent to.
</ul>
<b>NOTE: Be very careful when setting the <code>dns-spoof</code> option.
Some DNS servers may send responses from different port numbers as part of their normal operation.  Moreover, multi-homed servers
may send responses from different IP addresses.  If you don't need to use this option, don't.</b>
</p>

<a name="FILTER_LEVELS"></a>
<h2>Filter Levels</h2>
<h3>
<code>filter-level</code>
</h3>
<p>
spamdyke's overall filter behavior can be controlled with the <code>filter-level</code> option.
<b>NOTE: <code>filter-level</code> takes precedence over all other filters and features, including authentication and whitelisting.</b>
</p><p>
The possible values are:
<ul>
<li><code>allow-all</code>: Allow all connections, effectively whitelisting everything.
<li><code>normal</code>: Allow only the connections that pass the enabled filters.  This is the default.
<li><code>require-auth</code>: Allow only authenticated connections, even the ones that match a whitelist entry.
<li><code>reject-all</code>: Reject all connections, even if they are whitelisted or authenticated.
</ul>
</p><p>
The values <code>allow-all</code> and <code>reject-all</code> are most useful within configuration
directories, where they can be set e.g. for specific recipients.
</p>

<a name="TLS"></a>
<h2>TLS</h2>
<h3>
<code>tls-certificate-file</code><br />
<code>tls-cipher-list</code><br />
<code>tls-dhparams-file</code><br />
<code>tls-level</code><br />
<code>tls-privatekey-file</code><br />
<code>tls-privatekey-password</code><br />
<code>tls-privatekey-password-file</code>
</h3>
<p>
TLS is another name for SSL, the same encryption protocol used by secure
websites (it's called SSL when the entire connection is encrypted from the start,
it's called TLS when the encryption is started later during the connection).
TLS can be used during SMTP to provide secure communications between the remote client and the server.
</p><p>
spamdyke supports TLS in several ways.  First, with no TLS options given,
spamdyke will identify a TLS conversation and simply pass the data back and
forth between qmail and the remote client.  In this mode, spamdyke cannot read
the SMTP data (obviously -- it's encrypted).  This prevents some of its filters
from functioning, including graylisting, sender and recipient blacklisting,
limiting the number of recipients, checking the sender's domain name for an MX
record and relaying.
</p><p>
Second, spamdyke can provide TLS itself.  To do this, it must be compiled with
TLS support, which requires OpenSSL libraries on the server (see
the <a href="INSTALL.txt">Installation instructions</a> for details).
The value of the <code>tls-level</code> option controls how TLS is provided:
<ul>
<li><code>none</code>: Do not provide or allow TLS, even if qmail supports it.
qmail's attempt to advertise its TLS support will be hidden and the remote
server's request for TLS will be denied.
<li><code>smtp</code>: Provide TLS during the SMTP session, so it can be
started if the remote server requests it.  spamdyke will decrypt all of the
data and pass the plaintext to qmail.  qmail will not be aware TLS is
happening.  In this mode, qmail does not need to be patched to provide TLS.
However, if the SSL library cannot be initialized for some reason (e.g.
missing certificate, bad cipher list), the TLS data will be passed through to
qmail in encrypted format so qmail can provide TLS (assuming qmail has been patched to support it).  In this mode, spamdyke
will not be able to read the data, so some of its filters will not function.
<li><code>smtp-no-passthrough</code>: Provide TLS during the SMTP session, so it can be
started if the remote server requests it.  spamdyke will decrypt all of the
data and pass the plaintext to qmail.  qmail will not be aware TLS is
happening.  In this mode, qmail does not need to be patched to provide TLS.
If spamdyke cannot start TLS for any reason, the encrypted data will not be
passed through to qmail.
<li><code>smtps</code>: Start an SSL session as soon as the connection is
opened.  This mode is called "SMTP over SSL" or "SMTPS".  The remote client
must support this method.  Typically, SMTPS is offered on port 465, not port
25.
</ul>
</p><p>
If <code>tls-level</code> is <code>smtp</code>, <code>smtp-no-passthrough</code> or <code>smtps</code>,
the server certificate must also be provided with
the <code>tls-certificate-file</code> parameter.
</p><p>
The server certificate file must be in PEM format.  If the private key is not in
the certificate file, it must be provided in PEM format with the
<code>tls-privatekey-file</code> parameter.  If the private key is encrypted with a
password, the password must be provided with the <code>tls-privatekey-password</code>
parameter.  Because providing the private key password on the command line is
very insecure, the password can also be contained in a file and loaded using
the <code>tls-privatekey-password-file</code> parameter.
</p><p>
Generating self-signed certificates is very easy with OpenSSL.  Countless
tutorials are available on the web.
</p><p>
Rarely, some situations will require specifying the list of encryption algorithms (ciphers)
to be used during TLS.  In those cases, the <code>tls-cipher-list</code> option can be used
to pass a list of ciphers in the format expected by the OpenSSL library.  The vast majority
of spamdyke installations will not need this option -- the default list of ciphers is usually fine.
To see the full list of available ciphers, run the command <code>openssl ciphers</code>.
For details on how to construct the list, see <a href="http://www.openssl.org/docs/apps/ciphers.html">www.openssl.org/docs/apps/ciphers.html</a>.
<b>NOTE:</b> Be careful to check the list of ciphers very carefully -- invalid ciphers (typos) are allowed and will be silently ignored.
The OpenSSL library will only produce an error if none of the ciphers in the list can be used.
</p><p>
Some ciphers will generate "ephemeral" keys for encrypting the connection, which provides
an extra level of security (referred to as "forward security").  In order to do this, an additional "DH params" file must be provided in PEM
format with the <code>tls-dhparams-file</code> option.  The file can be generated using the <code>openssl dhparam</code>
command.  <b>NOTE:</b> This option is unneeded unless the <code>tls-cipher-list</code> option is
also used to specify a cipher that requires a "DH params" file.
</p><p>
If there are any problems reading the certificate, the private key, decrypting
the private key or initializing the ciphers, spamdyke will log the errors to syslog and fall back to passing
the TLS data through to qmail, if qmail has been patched to provide TLS
(or spamdyke will send the remote client an error message if qmail doesn't provide
TLS).  spamdyke will also log the error messages produced by OpenSSL, even
though they're rarely helpful.
</p><p>
NOTE: spamdyke does not disable any of its filters simply because a remote
client uses TLS or SSL.  In SMTP, TLS/SSL is simply a method of securing the communication
channel.  It is not an authentication method and spammers are using TLS.
spamdyke will only disable its filters for clients it finds on its whitelists or ones that use
SMTP AUTH.
</p><p>
If in doubt about enabling TLS, do it.  Encrypting email data is always a
good thing.
</p>

<a name="SMTP_AUTH"></a>
<h2>SMTP AUTH</h2>
<h3>
<code>hostname</code><br />
<code>hostname-command</code><br />
<code>hostname-file</code><br />
<code>smtp-auth-command</code><br />
<code>smtp-auth-level</code>
</h3>
<p>
SMTP AUTH is a mechanism for remote users to authenticate before sending email
(defined in RFC 2554).  This is very handy when users are likely to connect from
remote locations (e.g. coffee shops, hotels) and want to bypass relaying
restrictions and other filters.  spamdyke will disable all of its filters for
authenticated connections unless the <code>filter-level</code> option overrides
this behavior.  See <a href="#FILTER_LEVELS">Filter Levels</a> for details.
</p><p>
spamdyke supports SMTP AUTH according to the value of the <code>smtp-auth-level</code>
option:
<ul>
<li><code>none</code>: Do not offer or allow SMTP AUTH.  If qmail has been patched to
provide SMTP AUTH, spamdyke will block its advertisement of SMTP AUTH and will prevent
the remote server from authenticating.
<li><code>observe</code>: If qmail has been patched to provide SMTP AUTH, simply observe
the authentication and trust qmail's response.  If qmail has not been patched to provide
SMTP AUTH, do not provide SMTP AUTH.  This is the default.
<li><code>ondemand</code>: If qmail has been patched to provide SMTP AUTH, simply observe
the authentication and trust qmail's response.  If qmail has not been patched to provide
SMTP AUTH, offer it and process the authentication without letting qmail know it took
place.
<li><code>ondemand-encrypted</code>: Offer SMTP AUTH as needed, just like <code>ondemand</code>,
but also offer the encrypted protocol CRAM-MD5.  See below for a full description.
<li><code>always</code>: Always offer and process SMTP AUTH, even if qmail has been patched
to provide SMTP AUTH.  This value should only be used if qmail's authentication
is malfunctioning for some reason.
<li><code>always-encrypted</code>: Always offer and process SMTP AUTH, just like <code>always</code>,
but also offer the encrypted protocol CRAM-MD5.  See below for a full description.
</ul>
</p><p>
When the value of <code>smtp-auth-level</code> is <code>ondemand</code>, <code>ondemand-encrypted</code>,
<code>always</code> or <code>always-encrypted</code>, the option <code>smtp-auth-command</code>
must also be given to provide spamdyke with the command for processing authentication.
If multiple commands are available, <code>smtp-auth-command</code> may be given multiple
times.  spamdyke will run each command in order until one of them is successful.
</p><p>
For bare qmail installations where the users are stored in <code>/etc/passwd</code> the value of <code>smtp-auth-command</code> is usually:
<dl>
<dd><code>/bin/checkpassword /bin/true</code>
</dl>
For vpopmail users, the value of <code>smtp-auth-command</code> is usually:
<dl>
<dd><code>/home/vpopmail/bin/vchkpw /bin/true</code>
</dl>
</p><p>
For Plesk users, the values of <code>smtp-auth-command</code> are usually:
<dl>
<dd><code>/var/qmail/bin/smtp_auth /var/qmail/bin/true</code>
<dd><code>/var/qmail/bin/cmd5checkpw /var/qmail/bin/true</code>
</dl>
</p><p>
Some background on encrypted authentication: SMTP AUTH can be done using one of several protocols,
defined by RFC 2554.  Two of them are very simple: LOGIN and PLAIN.  Although they work
slightly differently, LOGIN and PLAIN both send the username and password to the server,
which authenticates them.  With these protocols, the server does not have to store the user's
password in an unencrypted format.  If the passwords are encrypted on the server, the authentication
process can simply encrypt the password it receives and compare the two
encrypted versions.  If they match, the password must have been correct.
</p><p>
Unfortunately, this means that the password must be sent to the server in an unencrypted
format so the authentication process can encrypt it for comparison.  Unless an external
encryption protocol is used (e.g. TLS or SMTPS), the passwords are theoretically vulnerable
to eavesdropping.
</p><p>
For this reason, another protocol was created called CRAM-MD5.  CRAM-MD5 is a
"challenge/response" protocol, which allows authentication to take place without sending
the password to the server in an unencrypted form.  In essence, the protocol starts when the
server generates some random text and sends it to the remote client (the "challenge").  The remote client
encrypts the text with the user's password and sends it back to the server (the "response").  The server also
encrypts the text with the user's password and compares the result to the response
from the client.  If they match, the remote client must have the correct password.
</p><p>
The challenge text is generated from several sources, including the name of the local server.
The <code>hostname</code>, <code>hostname-command</code> or <code>hostname-file</code>
option can be used to provide the local server's name for this reason.  When <code>hostname</code>
is used, the value should be the server's name.  When <code>hostname-command</code> is used,
the value should be a command that will print the server's name as its first line of output.
When <code>hostname-file</code> is used, the value should be the path to a file that contains
the server's name as its first line.  By default, <code>hostname-file</code> is set to <code>/var/qmail/control/me</code>.
<b>NOTE: If the local server's name is not provided,
CRAM-MD5 will still work and it will still generate random challenge text.  Using the local server's name
only makes it <i>slightly</i> more secure.  It's not worth a large effort to provide it.</b>
</p><p>
Unfortunately, this means that the password must be stored on the server in an unencrypted
format so the authentication process can use it to encrypt the challenge text.  Theoretically, this
leaves the passwords vulnerable to theft by an intruder who breaks into the server.
</p><p>
When <code>smtp-auth-level</code> is <code>ondemand-encryption</code> or <code>always-encryption</code>,
spamdyke will offer the CRAM-MD5 protocol to the remote client.  However, if the passwords
are not stored on the server in an unencrypted format <b>or</b> if the authentication command
does not understand CRAM-MD5, CRAM-MD5 will always fail.
</p><p>
If you're not sure which value to use, run spamdyke with the <code>config-test</code> option.
It will test the authentication commands and recommend a value.
See <a href="#CONFIGURATION_TEST">Configuration Tests</a>
for details.
</p><p>
If in doubt about enabling SMTP AUTH, do it.  Authenticating your users is
always a good thing.
</p>

<a name="RELAYING"></a>
<h2>Relaying</h2>
<h3>
<code>ip-relay-entry</code><br />
<code>ip-relay-file</code><br />
<code>rdns-relay-entry</code><br />
<code>rdns-relay-file</code><br />
<code>relay-level</code>
</h3>
<p>
A little background: when a message is delivered for a recipient that isn't hosted on the local server,
that message is said to be "relayed".  Most servers do not allow relaying except from authorized sources,
in order to prevent abuse by spammers or poorly-configured software.  When a server allows every connection
to relay messages without authentication, it is called an "open relay".  Open relays are quickly blacklisted
all across the internet because spammers quickly exploit them for sending massive amounts of email.
</p><p>
Remote servers are allowed to relay if the environment variable <code>RELAYCLIENT</code> is
set to any value.  Most qmail guides recommend an entry like this one in the <code>/etc/tcp.smtp</code> file:
<dl>
<dd><code>11.22.33.44:allow,RELAYCLIENT=""</code>
</dl>
</p><p>
spamdyke's <code>relay-level</code> option controls how spamdyke controls relaying.  The available
options are:
<ul>
<li><code>block-all</code>: Block all attempts at relaying, even if the remote server has
authenticated.
<li><code>normal</code>: Do not check for or prevent relaying and do not interfere with qmail's relay
filter. Authenticated connections and any servers identified by the options
<code>ip-relay-entry</code>,
<code>ip-relay-file</code>,
<code>rdns-relay-entry</code> and
<code>rdns-relay-file</code> are allowed to relay.
This is the default.
<li><code>allow-all</code>: Allow all connections to relay messages (create an open relay).
This is not recommended.
</ul>
</p><p>
spamdyke will allow relaying from IP addresses listed in a file and given with the option <code>ip-relay-file</code>.
See <a href="README_ip_file_format.html">IP Address Files</a> for details on the format of this file.  If the <code>ip-relay-file</code>
option is given multiple times, each file will be checked for the remote IP address; relaying will be allowed if the IP address is
found in any of the files.
</p><p>
If only a few IP addresses should be allowed to relay, the option <code>ip-relay-entry</code> may be used instead.
The entries should follow the format as the lines in an IP address file.
</p><p>
Alternatively, spamdyke will allow relaying from rDNS names listed in a file and given with the option <code>rdns-relay-file</code>.
See <a href="README_rdns_file_format.html">rDNS Files</a> for details on the format of this file.  If the <code>rdns-relay-file</code>
option is given multiple times, each file will be checked for the rDNS name; relaying will be allowed if the rDNS name is
found in any of the files.
</p><p>
If only a few rDNS names should be allowed to relay, the option <code>rdns-relay-entry</code> may be used instead.
The entries should follow the format as the lines in an rDNS file.
</p>

<a name="RDNS"></a>
<h2>Reverse DNS</h2>
<h3>
<code>ip-in-rdns-keyword-blacklist-entry</code><br />
<code>ip-in-rdns-keyword-blacklist-file</code><br />
<code>ip-in-rdns-keyword-whitelist-entry</code><br />
<code>ip-in-rdns-keyword-whitelist-file</code><br />
<code>reject-empty-rdns</code><br />
<code>reject-ip-in-cc-rdns</code><br />
<code>reject-unresolvable-rdns</code>
</h3>
<p>
Reverse DNS is the part of the DNS system that maps IP addresses back to names.
<b>If you don't understand reverse DNS, please please <i>please</i> read one of the
(thousands of) online tutorials on the subject.  Every mail server administrator
should know about reverse DNS.  It's not complicated.  Please take the time to learn it.</b>
</p><p>
spamdyke does a lot of work with rDNS names.  The first and most basic test is
to make sure the remote server <u>has</u> an rDNS name, any name.  This filter is
activated with the <code>reject-empty-rdns</code> option.  AOL and most other
major ISPs use this test.  By default, this filter is not run.
</p><p>
The next test is to make sure the remote server's rDNS name resolves.  This
test only attempts to get at least one IP address from the name.  It does not
require the rDNS name's IP address to match the remote server's IP address.
For example, if the remote
server's IP address is <code>11.22.33.44</code> and its rDNS name is <code>mail.example.com</code>,
this test will query <code>mail.example.com</code>.  Even if it resolves to
<code>66.77.88.99</code>, the test will pass.
Note: The name <code>localhost</code> is handled specially.  If the rDNS name is <code>localhost</code> and
the IP address is not <code>127.0.0.1</code>, the test fails.
This filter is activated with the
<code>reject-unresolvable-rdns</code> option.  By default, this filter is not run.
</p><p>
NOTE: <code>reject-unresolvable-rdns</code> does <u>not</u> imply <code>reject-empty-rdns</code>.
In other words, using just the <code>reject-unresolvable-rdns</code> option will
block connections from servers with unresolvable rDNS names but it will <u>not</u>
block connections from servers with no rDNS names at all.  Most users will want
to use <code>reject-empty-rdns</code> if they use <code>reject-unresolvable-rdns</code>.
</p><p>
spamdyke also has several filters that look for an IP address in the rDNS name, since that typically
indicates a server sending email that shouldn't be (e.g. a virus-infected Windows
machine on a cable modem).  If the rDNS name contains the IP address and a keyword given with the
<code>ip-in-rdns-keyword-blacklist-entry</code> option, spamdyke will block the connection.
</p><p>
Simple keywords can be provided.  For example, <code>dynamic</code> will match an rDNS name like
<code>11.22.33.44.dynamic.example.com</code>. NOTE: The keyword will not be matched in
the domain name (i.e. the keyword <code>example</code> would not be found).
</p><p>
Domain names can be provided if they are preceded by a dot.  For example, <code>.example.com</code>
(or just <code>.com</code>) will match <code>11.22.33.44.dynamic.example.com</code>.
</p><p>
Complex patterns can also be provided to match multiple keywords in sequence.  When the
keywords are separated by spaces, spamdyke will only find a match if all of the keywords
are found.  For example, <code>cable dynamic .example.com</code> will match
<code>11.22.33.44.cable.modem.dynamic.customer.example.com</code> but it will not match
<code>11.22.33.44.cable.modem.static.customer.example.com</code>.
</p><p>
All keyword searches are case-insensitive.
</p><p>
If more than a few keywords are provided, the <code>ip-in-rdns-keyword-blacklist-file</code>
option is much more efficient.  The keywords (or patterns) should be listed one per line.
Blank lines and lines beginning with <code>#</code> will be ignored.
</p><p>
spamdyke also accepts the <code>ip-in-keyword-whitelist-entry</code> and
<code>ip-in-keyword-whitelist-file</code> options that match keywords exactly the same
way as the blacklist options.  The whitelist options bypass all filters when a connection
matches, however, instead of blocking the connection.
</p><p>
spamdyke offers one other option that searches for an IP address in the rDNS name:
<code>reject-ip-in-cc-rdns</code>.  In essence, this option is the same as using
<code>ip-in-rdns-keyword-blacklist-entry</code> for every two-letter country code (e.g. <code>.us</code>).
This option is not very useful for large servers or servers outside the United States.
As ICANN begins allowing arbitrary top-level domains, two-letter domains will no longer
be a reliable way of detecting non-US servers.
</p><p>
When matching an IP address in an rDNS name, spamdyke looks for the IP address in many forms;
for example, if the IP address is <code>11.22.33.44</code>, spamdyke will look for the
following patterns in the rDNS name (the dots in the examples below can
be any single character):
<dl>
<dd><code>11.22.33.44</code>
<dd><code>011.022.033.044</code>
<dd><code>11.022.033.044</code>
<dd><code>11.22.033.044</code>
<dd><code>11.22.33.044</code>
<dd><code>44.33.22.11</code>
<dd><code>44.33.22.011</code>
<dd><code>44.33.022.011</code>
<dd><code>44.033.022.011</code>
<dd><code>044.033.022.011</code>
<dd><code>44.11.22.33</code>
<dd><code>33.22.11.44</code>
<dd><code>44.33.1122</code>
<dd><code>3344.11.22</code>
<dd><code>11.22.8492</code> (last two octets combined and converted to an integer)
<dd><code>11223344</code>
<dd><code>11.22.3344</code>
<dd><code>11.223344</code>
<dd><code>011022033044</code>
<dd><code>11022033044</code>
<dd><code>1122033044</code>
<dd><code>112233044</code>
<dd><code>44332211</code>
<dd><code>044033022011</code>
<dd><code>3930621781</code> (entire address converted to an integer)
<dd><code>5080d7e3</code> (each octet converted to hexadecimal)
</dl>
</p>

<a name="BLACKLISTS"></a>
<h2>Blacklists</h2>
<h3>
<code>ip-blacklist-entry</code><br />
<code>ip-blacklist-file</code><br />
<code>rdns-blacklist-dir</code><br />
<code>rdns-blacklist-entry</code><br />
<code>rdns-blacklist-file</code>
</h3>
<p>
First, let's all agree that blacklists are evil, arbitrary, unforgiving, unfair,
etc, etc, blah blah blah.  OK.  If you feel that way, don't use one.
</p><p>
<b>But</b>, if you decide to use one, it can block over half the spam you would
otherwise receive.  Blacklists are very effective against professional spammers
who buy thousands of domain names and run their own mail servers
(constantly moving them around, of course).  It's your decision.
</p><p>
NOTE: Constructing and maintaining a blacklist is left as an exercise for the
reader.  spamdyke will use a blacklist but it won't help you build one.
</p><p>
spamdyke will search for the remote server's rDNS name in a file
and block the connection if it is found.  This is activated with the
<code>rdns-blacklist-file</code> option.  See <a href="README_rdns_file_format.html">rDNS Files</a> for details on the
format of this file.  If the <code>rdns-blacklist-file</code> option is given multiple times, each
file will be checked before the connection is allowed.
</p><p>
If only a few rDNS names should be blacklisted, the option <code>rdns-blacklist-entry</code>
can be used instead.  The entries should follow the same format as the lines in an rDNS file.
</p><p>
spamdyke will also search for the remote server's rDNS name in a directory structure
and block the connection if it is found.  For large lists of rDNS names (more than
100), the directory structure is much faster than a file.  This is activated with the
<code>rdns-blacklist-dir</code> option.  See <a href="README_rdns_directory_format.html">rDNS Directories</a> for details on the
structure of this directory.  If the <code>rdns-blacklist-dir</code> option is given multiple times, each
directory will be checked before the connection is allowed.
</p><p>
spamdyke will also search for the remote server's IP address in a file and
block the connection if it is found.  This is activated with the
<code>ip-blacklist-file</code> option.  See <a href="README_ip_file_format.html">IP Address Files</a> for details on the
format of this file.  If the <code>ip-blacklist-file</code> option is given multiple times, each
blacklist file will be checked before the connection is allowed.
</p><p>
If only a few IP addresses should be blacklisted, the option <code>ip-blacklist-entry</code>
can be used instead.  The entries should follow the same format as the lines in an IP address file.
</p>

<a name="DNSRBL"></a>
<h2>DNS RBLs</h2>
<h3>
<code>dns-blacklist-entry</code><br />
<code>dns-blacklist-file</code><br />
</h3>
<p>
DNS Realtime Blackhole Lists are services maintained by third parties that list
IP addresses (presumably the IP addresses of spammers).  The criteria for getting listed on a DNS RBL vary by organization and
it's often very hard to get delisted.  Sometimes, listings are politically
motivated; some DNS RBL operators try to force large ISPs to cancel spammers'
accounts by listing all of the ISP's IP addresses, innocent or guilty.  If you
choose to use a DNS RBL, please do some preliminary research to understand its
policies and history of complaints.
</p><p>
spamdyke will reject connections from an IP address listed in a given DNS RBL.
This feature is activated with the <code>dns-blacklist-entry</code> option.  By default,
spamdyke does not use a DNS RBL.  If the <code>dns-blacklist-entry</code> option is given multiple times, each
DNS RBL will be checked before the connection is allowed.
</p><p>
If more than a few DNS RBLs are needed, the <code>dns-blacklist-file</code> option is
more efficient than <code>dns-blacklist-entry</code>.  Each line in the file should contain
the name of one DNS RBL.
</p><p>
<b>NOTE: Checking DNS RBLs can impose a serious performance penalty.  Using more than three
DNS RBLs is not recommended.</b>
</p>

<a name="DNSRHSBL"></a>
<h2>DNS RHSBLs</h2>
<h3>
<code>rhs-blacklist-entry</code><br />
<code>rhs-blacklist-file</code><br />
</h3>
<p>
DNS Righthand-side Blacklists are services maintained by third parties that list
domain names (presumably the domain names of spammers).  The criteria for getting listed on a DNS RHSBL vary by organization and
it's often very hard to get delisted.  Sometimes, listing are politically
motivated; some DNS RHSBL operators try to force large ISPs to cancel spammers'
accounts by listing all of the ISP's domain names, innocent or guilty.  If you
choose to use a DNS RHSBL, please do some preliminary research to understand their
policies and history of complaints.
</p><p>
spamdyke will reject connections from servers whose reverse DNS names are listed in a given DNS RHSBL.
spamdyke will also reject connections from senders whose email domain names are listed in a given DNS RHSBL.
These features are activated with the <code>rhs-blacklist-entry</code> option.  By default, spamdyke does
not use a DNS RHSBL.  If the <code>rhs-blacklist-entry</code> option is given multiple times, each
DNS RHSBL will be checked before the connection is allowed.
</p><p>
If more than a few DNS RHSBLs are needed, the <code>rhs-blacklist-file</code> option is
more efficient than <code>rhs-blacklist-entry</code>.  Each line in the file should contain
the name of one DNS RHSBL.
</p><p>
<b>NOTE: Checking DNS RHSBLs can impose a serious performance penalty.  Using more than three
DNS RHSBLs is not recommended.</b>
</p>

<a name="WHITELISTS"></a>
<h2>Whitelists</h2>
<h3>
<code>ip-whitelist-entry</code><br />
<code>ip-whitelist-file</code><br />
<code>rdns-whitelist-dir</code><br />
<code>rdns-whitelist-entry</code><br />
<code>rdns-whitelist-file</code>
</h3>
<p>
spamdyke will match the remote server's rDNS name against a list given with
the <code>rdns-whitelist-entry</code> option and skip all filters if it is found.
If more than a few entries are given, the <code>rdns-whitelist-file</code> option
is much more efficient; it can be used to put the entries in a file, one per line.
See <a href="README_rdns_file_format.html">rDNS Files</a> for details on the
format of this file.  If <code>rdns-whitelist-file</code> option is given multiple times, each whitelist
file will be checked before the connection is blocked.
</p><p>
spamdyke will also search for the remote server's rDNS name
in a directory structure and skip all filters if it is found.  This is activated with the
<code>rdns-whitelist-dir</code> option.  See <a href="README_rdns_directory_format.html">rDNS Directories</a> for details on the
format of this directory structure.  If <code>rdns-whitelist-dir</code> option is given multiple times, each
directory will be checked before the connection is blocked.
</p><p>
spamdyke will also search for the remote server's IP address in a list of entries and
skip all filters if it is found.  This is activated with the
<code>ip-whitelist-entry</code> option.  If more than a few entries are given,
the <code>ip-whitelist-file</code> option is more efficient; it can be used to
put the entries in a file.  See <a href="README_ip_file_format.html">IP Address Files</a> for details on the
format of this file.  If the <code>ip-whitelist-file</code> option is given multiple times, each whitelist
file will be checked before the connection is blocked.
</p>

<a name="REJECTING_SENDERS"></a>
<h2>Rejecting Senders</h2>
<h3>
<code>reject-sender</code><br />
<code>sender-blacklist-entry</code><br />
<code>sender-blacklist-file</code>
</h3>
<p>
Before using spamdyke's options to block senders, it's important to understand the difference between a
"sender address" (sometimes call the "envelope sender") and the "from address".  The "sender address" is
the email address given to the mail server when the message arrives and it's where a bounce message will be
sent.  The "from address" is what the user sees in their email client on the "from" line.  The two addresses can
be completely different and totally unrelated.  To use an analogy, the "sender address" is like the return
address written on the outside of a snail mail envelope.  If the envelope can't be delivered, the post office
will send it back to the sender address.  The "from address" is like the address on the top of the letter inside
the envelope.  The post office never sees the letter inside the envelope, so it they can't use it.  spamdyke (and
qmail) is like the post office -- it uses only the "sender" address.  That's why the filters described in this section work on the "sender"
address, not the "from" address.  To block messages based on the "from" address, see <a href="#HEADERS">Rejecting Messages by Header Content</a>.
</p><p>
spamdyke will block all incoming messages from a specific address
with the <code>sender-blacklist-entry</code> option.  If more than a few addresses
are given, the <code>sender-blacklist-file</code> option is more efficient.
The given file must contain one
email address per line.  Blank lines and lines beginning with <code>#</code> are ignored.
If the <code>sender-blacklist-file</code> option is given multiple times, each blacklist file will be
checked before the connection is blocked.
</p><p>
One form of wildcard address is supported.  All usernames within a domain
(and its subdomains) may be blocked by a line starting with <code>@</code>.
For example, if the file contained the following entry:
<dl>
<dd><code>@example.com</code>
</dl>
spamdyke will block mail to <code>fred@example.com</code>, <code>fred@mail.example.com</code>,
<code>barney@mail.internal.example.com</code>, etc.
</p><p>
spamdyke's <code>reject-sender</code> option controls several other filters for blocking senders and it
can be used multiple times to enable more than one filter.  The available options are:
<ul>
<li><code>none</code>: Disable the <code>reject-sender</code> filters.  This is the default.

<li><code>no-mx</code>: Use DNS to check if a sender's domain name can receive email.
To pass this filter, the sender's domain name must have a valid mail exchanger (MX record) and
the mail exchanger must have an IP address (A record).
This filter tends to
block a lot of mail from compromised web servers that aren't supposed to be sending email.

<li><code>not-local</code>: Senders are only accepted if their domain name is hosted on the
local server.  This is determined by searching the files given using the <code>qmail-rcpthosts-file</code>
and <code>qmail-morercpthosts-cdb</code> options.  Those options have default values but if the files do not exist or those options are cleared, this value has
no effect.  See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for more details on those options.

<li><code>authentication-mismatch</code>: Senders are only accepted if the sender address is the same as the
username that was used for authentication.  This filter enforces an exact match.  For example, if the
mail client authenticated with the username <code>fred@example.com</code>, the sender must be exactly
<code>fred@example.com</code>.  If the mail client authenticated with a username that wasn't an email
address, this filter will only match the username portion of the sender address.  For example, if the
mail client authenticated with just <code>barney</code>, this filter will allow both
<code>barney@example.com</code> and <code>barney@somethingelse.net</code>, because they
both begin with <code>barney@</code>.
<b>NOTE:</b> if the mail client does not authenticate, this value has no effect.

<li><code>authentication-domain-mismatch</code>: Senders are only accepted if the sender's domain name is
the same as the domain name of the email address used for authentication.  For example, if the mail client
authenticated with the username <code>wilma@bedrock.com</code>, the sender address <code>barney@bedrock.com</code>
will be accepted but <code>fred@flintstone.com</code> will not.  If the mail client authenticates with a
username that isn't an email address, this value has no effect.
<b>NOTE:</b> if the mail client does not authenticate, this value has no effect.

</ul>
</p>

<a name="REJECTING_RECIPIENTS"></a>
<h2>Rejecting Recipients</h2>
<h3>
<code>qmail-morercpthosts-cdb</code><br />
<code>qmail-rcpthosts-file</code><br />
<code>recipient-blacklist-entry</code><br />
<code>recipient-blacklist-file</code><br />
<code>recipient-validation-command</code><br />
<code>reject-recipient</code>
</h3>
<p>
There are lots of different reasons for wanting to block messages to specific recipient addresses.
Sometimes spammers will choose to target a specific address and send it thousands of messages.
Sometimes a spammer will use one of your email addresses as the sender address on thousands of spam messages and you receive bounce messages for all of their spams.
(This is commonly referred to as a "joe job".)
Many spammers attempt to send messages that are "from" and "to" the same address, hoping to bypass spam filters.
spamdyke can stop those messages as well.
</p><p>
But most often, qmail administrators need a way to stop "backscatter spam".  This is the name given to
spam that is sent to invalid addresses.  If the mail server accepts the message and later tries to send a bounce message, it results
in "backscatter" because the "from" address is almost always invalid, which makes the bounce message land in some other victim's mailbox.
qmail will do this, because it was created before spam was really a problem.
spamdyke can validate recipient addresses as they come in and reject invalid addresses, which stops backscatter spam in its tracks.
</p><p>
spamdyke will block all incoming messages to a specific address with the
<code>recipient-blacklist-entry</code> option.  If more than a few addresses
are given, the <code>recipient-blacklist-file</code> option is much more efficient.
The given file must contain one
email address per line.  Blank lines and lines beginning with <code>#</code> are ignored.
If the <code>recipient-blacklist-file</code> option is given multiple times, each blacklist file will be
checked before the connection is blocked.
</p><p>
One form of wildcard address is supported.  All usernames within a domain
(and its subdomains) may be blocked by a line starting with <code>@</code>.
For example, if the file contained the following entry:
<dl>
<dd><code>@example.com</code>
</dl>
spamdyke will block mail to <code>fred@example.com</code>, <code>fred@mail.example.com</code>,
<code>barney@mail.internal.example.com</code>, etc.
</p><p>
spamdyke's other recipient filters are activated through the <code>reject-recipient</code> option, which has the following options:
<ul>
<li><code>none</code>: Disable the <code>reject-recipient</code> filters.  This is the default.
<li><code>same-as-sender</code>: Reject any recipient address that is the same as the sender address.
<li><code>invalid</code>: Reject any invalid recipient address.  This filter rejects any address that will result in a bounce message from qmail.
<li><code>unavailable</code>: Reject any recipient address that is currently unavailable.  Under certain conditions (usually depending upon permission settings on specific files),
qmail will queue messages to an address until the conditions are resolved.  If the message is queued too long, it will bounce.  This feature may have been useful a few decades ago (maybe),
when everyone used text-based mail readers and routinely logged into shell accounts on their mail servers.  These days however, it has techically become a "misfeature".
If these conditions are ever triggered, they are almost certainly an accident and won't be corrected before the message bounces.
It's usually best to use this value whenever <code>invalid</code> is also in use.
</ul>
</p><p>
In order for spamdyke to reject invalid or unavailable recipients, it must have access to a number of qmail's control files.
Two files are used by spamdyke itself: the "rcpthosts" file and the "morercpthosts" CDB file.
The path to the "rcpthosts" file is usually <code>/var/qmail/control/rcpthosts</code>, but this default value can be changed with the <code>qmail-rcpthosts-file</code>.
Similarly, the path to the "morercpthosts" CDB file is usually <code>/var/qmail/control/morercpthosts.cdb</code>, but this default value can be changed with <code>qmail-morercpthosts-cdb</code>
(be sure to provide the path to the CDB file, not the text that was used to create it).
<b>NOTE:</b> The only reason to change the paths to these two files is if qmail was compiled to use files in a different location.
If different input files are provided to spamdyke and qmail, the recipient validation procedure will not function properly.
</p><p>
For the remainder of the recipient validation process, a number of other qmail configuration files must be accessed, along with the recipients' mail configuration files (often stored in their home directories).
Unfortunately, there is only one user (on most systems) who can access all the needed files: root.
spamdyke does not normally run as root because it is started by the tcpserver process, which is typically run with a non-root account.
For this reason, the recipient validation procedure is contained in <code>spamdyke-qrv</code>, which is intended to be run as root (technically "setuid root").
spamdyke-qrv will validate an address and return its result to spamdyke, which allows spamdyke to function while running as a non-root user.
In order to use spamdyke-qrv, the <code>recipient-validation-command</code> option must be given with the full path to the spamdyke-qrv binary (spamdyke will not
search the <code>PATH</code> for spamdyke-qrv).
</p><p>
For full details on spamdyke-qrv and how it works, see <a href="README_spamdyke_qrv.html">Recipient Validation With spamdyke-qrv</a>.
</p>

<a name="DNSWHITELISTS"></a>
<h2>DNS Whitelists</h2>
<h3>
<code>dns-whitelist-entry</code><br />
<code>dns-whitelist-file</code><br />
<code>rhs-whitelist-entry</code><br />
<code>rhs-whitelist-file</code><br />
</h3>
<p>
spamdyke has the ability to consult DNS whitelists and allow connections from hosts or
senders who match entries on them.  DNS whitelists are essentially DNS RBLs and DNS RHSBLs
that list allowed IP addresses and domain names instead of blocked ones.  All of the
same cautionary statements apply to DNS whitelists as to DNS blacklists.  See
<a href="#DNSRBL">DNS RBLs</a> and <a href="#DNSRHSBL">DNS RHSBLs</a> for details.
</p><p>
To use a DNS Realtime Whitelist (the opposite of a DNS RBL), the option <code>dns-whitelist-entry</code>
should be given.  To use a DNS Righthand-side Whitelist, the option <code>rhs-whitelist-entry</code>
should be given.  By default, spamdyke does not use a DNS whitelist.
If either option is given multiple times, each list will be
consulted before the connection is blocked.
</p><p>
If more than a few lists are given, the <code>dns-whitelist-file</code> or <code>rhs-whitelist-file</code>
options may be used to provide the lists in files.
</p><p>
<b>NOTE: Checking DNS whitelists can impose a serious performance penalty.  Using more than three
DNS whitelists is not recommended.</b>
</p>

<a name="WHITELISTING_ADDRESSES"></a>
<h2>Whitelisting Senders and Recipients</h2>
<h3>
<code>recipient-whitelist-entry</code><br />
<code>recipient-whitelist-file</code><br />
<code>sender-whitelist-entry</code><br />
<code>sender-whitelist-file</code>
</h3>
<p>
Sometimes, adding IP addresses and reverse DNS names to whitelist files is not
enough to satisfy some users.  Either they continue to receive mail from unexpected
places or they just think spamdyke is blocking their email.  In those cases, a
last resort can be to whitelist the sender or recipient address.
</p><p>
<b>NOTE: Using these features is a bad idea!</b>  Sender addresses are <u>very</u>
easy to forge; this is why spam is so hard to block.  Recipient addresses are
obviously already known to the spammers; this is why spam is delivered.  Whitelisting
any addresses this way <u>will</u> allow spam to get through.
</p><p>
To whitelist a sender or recipient address, the <code>sender-whitelist-entry</code>
or <code>recipient-whitelist-entry</code> option should be used, respectively.
The entries can use the same formats as those for <code>sender-blacklist-entry</code>
and <code>recipient-blacklist-entry</code>; see <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a>
for details.
</p><p>
Whitelist entries can be placed in files and referenced
with <code>sender-whitelist-file</code> or <code>recipient-whitelist-file</code>.
This is more efficient for more than a few entries.
</p>

<a name="GRAYLISTS"></a>
<h2>Graylisting / Greylisting</h2>
<h3>
<code>graylist-dir</code><br />
<code>graylist-exception-ip-entry</code><br />
<code>graylist-exception-ip-file</code><br />
<code>graylist-exception-rdns-dir</code><br />
<code>graylist-exception-rdns-entry</code><br />
<code>graylist-exception-rdns-file</code><br />
<code>graylist-level</code><br />
<code>graylist-max-secs</code><br />
<code>graylist-min-secs</code>
</h3>
<p>
Graylisting is the technique of denying mail delivery the first time a sender
tries to deliver to a recipient.  The next time the remote server attempts to
deliver the message, it is accepted.  All future messages from the sender to
the recipient are also allowed.
</p><p>
Graylisting works because spammers don't use real mail servers, so when the
initial delivery fails, they don't retry it.  Even if they do, they change to a
different random sender address, which is also graylisted.
</p><p>
spamdyke's graylisting is activated first with the <code>graylist-level</code>
option, which will accept the following values:
<ul>
<li><code>none</code>: Do not graylist any connections.  This is the default.
<li><code>always</code>: Always graylist connections if a domain folder exists
for the recipient and the remote server's IP address or rDNS name are not found
on one of the exception lists.
<li><code>always-create-dir</code>: Always graylist connections unless the remote
server's IP address or rDNS name are found on one of the exception lists.  If a
domain folder does not exist for the recipient, create it.
<li><code>only</code>: Do not graylist any connections unless a domain folder exists
for the recipient and the remote server's IP address or rDNS name are found on one of
the exception lists.
<li><code>only-create-dir</code>: Do not graylist any connections unless the remote
server's IP address or rDNS name are found on one of the exception lists.  If a
domain folder does not exist for the recipient, create it.
</ul>
</p><p>
The option <code>graylist-dir</code> is required if <code>graylist-level</code> is
not <code>none</code>.  The value of <code>graylist-dir</code> must be the path to
a directory where spamdyke has permission to create folders and write files.
</p><p>
A list of local domains must also be provided with <code>qmail-rcpthosts-file</code>.  Without a list of local domains, spamdyke cannot
know which domains should be graylisted.  See <a href="#REJECTING_RECIPIENTS">Rejecting Recipients</a> for details.
</p><p>
The "domain directories" required by <code>graylist-level</code>'s <code>always</code> and <code>only</code>
values are just folders named using the recipient's domain name.  For example, if
the value of <code>graylist-dir</code> is:
<dl>
<dd><code>/var/tmp/graylist.d</code>
</dl>
and the recipient's domain is <code>example.com</code>, the domain directory would be:
<dl>
<dd><code>/var/tmp/graylist.d/example.com</code>
</dl>
Domain directories allow graylisting to be selectively activated for only some domains.
If all domains should be graylisted, use <code>always-create-dir</code> or <code>only-create-dir</code>
instead.
</p><p>
NOTE: Domain directories must be named in lowercase.  Unfortunately, spamdyke cannot perform a case
insensitive search for directory paths.
</p><p>
If <code>graylist-dir</code> is given multiple times, spamdyke will search each given
directory for the recipient's domain folder.  If the domain folder is not found and the value
of <code>graylist-level</code> is <code>always-create-dir</code> or <code>only-create-dir</code>,
spamdyke will create a domain folder in the <u>last</u> directory given.
</p><p>
As spamdyke creates graylist entries, it breaks apart the sender's and recipient's addresses
to create folders.  For example, a graylist entry for messages from <code>sender@remote.com</code> to
<code>recipient@local.com</code> will be a file with the following path:
<dl>
<dd><code>.../local.com/recipient/remote.com/sender@remote.com</code>
</dl>
NOTE: This directory structure is different from the one created by spamdyke prior to
version 4.0.0.  If spamdyke encounters an old-style directory structure, it will silently
convert the entries to the new structure as they are used.
</p><p>
If the options <code>graylist-exception-ip-entry</code> or <code>graylist-exception-rdns-entry</code>
are given, spamdyke will reverse its graylist policy for remote servers whose
IP addresses or rDNS names, respectively, match the given entries.
</p><p>
If more than a few IP address or rDNS entries are given, the options <code>graylist-exception-ip-file</code>
and <code>graylist-exception-rdns-file</code> are more efficient.
See <a href="README_ip_file_format.html">IP Address Files</a> and <a href="README_rdns_file_format.html">rDNS Files</a>
for details on the formats of these files.
</p><p>
If more than 100 entries are given in an rDNS file, the option <code>graylist-exception-rdns-dir</code>
is more efficient than <code>graylist-exception-rdns-file</code>.  See
<a href="README_rdns_directory_format.html">rDNS Directories</a> for details.
</p><p>
spamdyke accepts two options to control the lifetimes of its graylist entries.
The option <code>graylist-min-secs</code> controls the minimum amount of time an
entry must exist before it is valid.  For example, if the value <code>300</code>
is given, a graylist entry is not valid until it has existed for at least 5 minutes.
This prevents a spammer from attempting delivery twice in rapid succession.
</p><p>
The option <code>graylist-max-secs</code> controls the maximum amount of time an
entry will remain valid after it is created.  For example, if the value <code>604800</code>
is given, a graylist entry will become invalid after 7 days.  If the sender attempts
to deliver a message after the entry has expired, they will be graylisted again.
NOTE: A graylist entry's expiration date is reset each time a message passes the
filter.  If the maximum age is 2 weeks and the sender sends a message every day,
their entry will never expire because it is continually reset.
</p><p>
As of 2013, graylisting is becoming more and more widespread.  Spammers are adapting by sending their spam through legitimate servers, which aren't stopped by graylisting.
There are still enough botnets using unintelligent spam software to make graylisting worthwhile but its effectiveness is definitely declining.
</p><p>
<b>NOTE:</b> Because spamdyke's graylist filter creates lots (and lots) of small files,
it can threaten a server's filesystem by consuming all of the available inodes
(especially on busy servers).  Be sure to monitor the number of available inodes
in case this becomes a problem.
</p>

<a name="EARLYTALKERS"></a>
<h2>Earlytalkers</h2>
<h3>
<code>greeting-delay-secs</code>
</h3>
<p>
Some years back, someone noticed that some spam software didn't follow the
SMTP protocol.  Specifically, spammers were opening connections to remote mail
servers and pushing out all of the mail commands as quickly as they could,
without waiting for (or checking) responses.  By delaying the sending of the
greeting banner, it's possible to catch these spammers and block them.
</p><p>
spamdyke will delay sending the opening greeting in order to wait for the sender
to send data.  If that happens, spamdyke will block the connection.  This is
activated with the <code>greeting-delay-secs</code> option.
</p><p>
It may seem strange that spamdyke will accept the <code>greeting-delay-secs</code> in a
configuration directory, since the delay must take place long before the sender or recipient addresses
are known.  There is one allowed scenario however -- the command line or global configuration file
may activate the earlytalker filter and the configuration directory may deactivate it.  In that case,
the connection will be delayed but the results of the test will be ignored.  The reverse is not possible
however -- the configuration directory cannot activate the filter or change its delay amount.
See <a href="#CONFIGURATION_DIR">Configuration Directories</a> for more information.
</p><p>
Unfortunately, spammers have mostly updated their software so this
trick doesn't work any more.  It still catches badly written botnet spam sources though.
</p><p>
Even if it doesn't catch the spammers any more, this is still a good test to
run because it slows down the rate at which spammers can send email.  Making it
more expensive for them is not a bad thing.
</p>

<a name="MAXRECIPIENTS"></a>
<h2>Limiting Numbers of Recipients</h2>
<h3>
<code>max-recipients</code>
</h3>
<p>
RFC 821 says an SMTP server must allow the remote server to specify as many
recipients as the SMTP server has memory to hold.  This allows spammers to
send a single message to (potentially) thousands of users in one connection.
</p><p>
spamdyke offers a way to violate the RFC by limiting the number of recipients
per message.  Once that number has been reached, the remaining
recipients will be rejected.  Legitimate mail servers use the multi-recipient
feature as well, but they will retry their deliveries.  Spammers generally
don't.
</p><p>
This feature is activated by the <code>max-recipients</code> option.  By default,
spamdyke allows unlimited recipients per connection.
</p><p>
If you enable this feature, make sure all of your users are using SMTP AUTH
or are allowed to relay or are whitelisted.  Otherwise, their MUAs will show
them error messages when they try to send to large address book mailing lists
and they will complain.  Loudly.
</p>

<a name="HEADERS"></a>
<h2>Rejecting Messages by Header Content</h2>
<h3>
<code>header-blacklist-entry</code><br />
<code>header-blacklist-file</code>
</h3>
<p>
Email messages are divided into two parts: the header and the body.  The header
is composed of data fields that are parsed by mail agents so the data can be
shown to the user in a useful way.  For example, the subject line and the date
are part of the header.  The message body contains all of the text (often HTML
these days) and attachment data.
<p></p>
spamdyke has the ability to filter incoming messages based on header content.
Every header line is supposed to use the following format:
<dl>
<dd><code>NAME: VALUE</code>
</dl>
For example:
<dl>
<dd><code>Subject: Fantastic news!</code>
</dl>
When <code>header-blacklist-entry</code> is used, its value will be matched
against each line in the incoming message header.  If one or more lines match,
the message will be rejected.  <code>header-blacklist-file</code> works much the
same way, except the values are read from the given file, one per line.
<p></p>
Before attempting to match values to headers, spamdyke first compresses any
whitespace by converting runs of multiple whitespace characters to a single space.
If the header line in the message occupies multiple lines, spamdyke "unfolds" it
into a single line.  The values are then compared in a case-insensitive manner.
All values must contain at least one colon (<code>:</code>) or they will be ignored.
<p></p>
Shell-style wildcards are allowed ("globbing"):
<ul>
<li>An asterisk (<code>*</code>) will match zero or more characters.
<li>A question mark (<code>?</code>) will match a single character.
<li>A bracketed series of characters (e.g. <code>[abcd]</code>) will match any one of the bracketed characters.
<li>...probably more, depending on the implementation of <code>fnmatch()</code> on your system.
</ul>
For example, this value:
<dl>
<dd><code>Subject:*c?a[i1]is*</code>
</dl>
Will match any of the following:
<dl>
<dd><code>Subject: cialis</code>
<dd><code>Subject: Got some cialis for you</code>
<dd><code>Subject: Need cXalis?</code>
<dd><code>Subject: Order cia1is today</code>
</dl>
<p></p>
<b>NOTE:</b> Be very careful when adding header blacklists.  Spammers are very clever
about avoiding content filtering (they have decades of experience) but normal users
are not.  It is very easy to create a blacklist entry that will block legitimate
email without blocking any spam at all.
<p></p>
<b>NOTE:</b> In order to filter headers, spamdyke must buffer the header
content in memory while the message is being delivered.  It will allocate up to
512K to do this.  <b>If you are using DJB's "softlimit" program to prevent excessive
memory allocation, you should remove it, period.
See <a href="#TROUBLE9">this FAQ question</a> for more details.</b>
<p></p>
When <code>header-blacklist-entry</code> or <code>header-blacklist-file</code>
are used within per-recipient configuration directories, they don't behave like
other options.  Most options can be set per-recipient and only affect delivery to
that recipient.  Header blacklisting is an all-or-nothing affair, so when those
options are found in a per-recipient configuration directory, they are cumulative.
For example, suppose two recipients have configuration directories.  In the first
recipient's directory, the following option is found:
<dl>
<dd><code>header-blacklist-entry=Subject: Cialis</code>
</dl>
In the second recipient's directory, another option is found:
<dl>
<dd><code>header-blacklist-entry=Subject: Viagra</code>
</dl>
When spamdyke applies the header blacklist filter, both values will be used.
If either one matches, the message will be rejected for both recipients (assuming
the incoming message is being delivered to both recipients simultaneously).
</p>

<a name="TIMEOUTS"></a>
<h2>Timeouts</h2>
<h3>
<code>connection-timeout-secs</code><br />
<code>idle-timeout-secs</code>
</h3>
<p>
Most spam software is pretty stupid and doesn't handle error codes from SMTP
servers.  Instead, they send their commands and wait for specific responses.
When those responses don't come, the software just sits forever and waits.
</p><p>
spamdyke will time out these connections in one of two ways.  First, an absolute
time limit can be imposed on a connection.  This is activated with the
<code>connection-timeout-secs</code> option.  If this feature is enabled, it should be
set to a very high value.  Large (legitimate) messages can take a very long time
to deliver, especially if the link is slow.  A value of <code>0</code> disables this feature.
By default, this feature is not activated.
</p><p>
Second, an idle time limit can be imposed on a connection.  This is activated
with the <code>idle-timeout-secs</code> option.  If no data is received within
the given number of seconds, the connection is closed.  A value of <code>0</code> disables this
feature.  By default, this feature is not activated.
</p>

<a name="UTILITIES"></a>
<h2>Extra Utilities</h2>
<p>
There are some additional programs included with spamdyke in the <code>utils</code> folder.
They are:
<dl>
<dt>domain2path
<dd>A utility for constructing rDNS folder paths from domain
    names.  Useful in scripts.
    See <a href="README_rdns_directory_format.html">rDNS Directories</a>
    for details on domain2path.
<dt>domainsplit
<dd>A utility for finding the base domain name of a fully qualified
    domain name.  For example, given <code>foo.bar.baz.example.com</code>, domainsplit will
    return </code>example.com</code>.  Also useful in scripts.
<dt>dnsa
<dd>An example program that demonstrates finding DNS A records (IP addresses) for fully qualified domain names.
<dt>dnsany
<dd>An example program that demonstrates finding DNS records of "any" type
(which doesn't actually return all types) for fully qualified domain names.
<dt>dnsany_libc
<dd>An example program that demonstrates finding DNS records of "any" type
(which doesn't actually return all types) for fully qualified domain names.
This version uses the system resolver library instead of sending UDP packets itself.
<dt>dnscname
<dd>An example program that demonstrates finding DNS CNAME records (alias names) for fully qualified domain names.
<dt>dnsmx
<dd>An example program that demonstrates finding DNS MX records (mail exchangers) for domain names.
<dt>dnsns
<dd>An example program that demonstrates finding DNS NS records (nameservers) for domain names.
<dt>dnsptr
<dd>An example program that demonstrates finding DNS PTR records (reverse DNS names) for fully qualified domain names or IP addresses.
<dt>dnssoa
<dd>An example program that demonstrates finding DNS SOA records (start-of-authority) for domain names.
<dt>dnstxt
<dd>An example program that demonstrates finding DNS TXT records (text information) for fully qualified domain names.
<dt>timefilter
<dd>A utility for filtering log files to display log entries from within a given date range.  Only really useful in scripts.
</dl>
</p><p>
None of these utilities depend on being installed in any specific folder.
None of them depend on the presence of the others or spamdyke.
<b>spamdyke does not require them or use them.</b>
</p>

</div>
</div>
<div id="footer">
copyright &copy;2015 Sam Clippinger |
<a href="mailto:samc%40silence%2Eorg">samc (at) silence (dot) org</a> |
<a href="http://www.dcarter.co.uk">design by dcarter</a>
</div>
</div>
</body>
</html>
